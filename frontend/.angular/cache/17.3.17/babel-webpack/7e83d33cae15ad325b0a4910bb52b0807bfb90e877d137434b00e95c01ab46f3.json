{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nlet ProfileUploadComponent = class ProfileUploadComponent {\n  constructor(api) {\n    this.api = api;\n    this.results = [];\n    this.loading = false;\n    this.filterPersona = \"\";\n    this.filterMinScore = 0;\n    this.maxResultCap = 5;\n    this.autoMaxResults = this.maxResultCap;\n    this.useAiRanking = false;\n    this.searchKeywords = [];\n  }\n  ngOnInit() {\n    this.autoSearch();\n  }\n  ngOnDestroy() {\n    this.clearJobState();\n  }\n  runMatch() {\n    this.error = undefined;\n    this.loading = true;\n    const payload = {\n      maxResults: this.cappedMaxResults(),\n      useAiRanking: this.useAiRanking\n    };\n    if (this.useAiRanking) {\n      this.startAsyncJob(payload);\n    } else {\n      this.fetchSync(payload);\n    }\n  }\n  autoSearch() {\n    this.error = undefined;\n    this.loading = true;\n    const payload = {\n      maxResults: this.cappedMaxResults(),\n      useAiRanking: this.useAiRanking\n    };\n    if (this.useAiRanking) {\n      this.startAsyncJob(payload);\n    } else {\n      this.fetchSync(payload);\n    }\n  }\n  applyResponse(resp) {\n    this.results = resp.profiles || resp.results || [];\n    this.searchKeywords = resp.search_plan?.keywords || [];\n    this.searchPlanNote = resp.search_plan?.explanation;\n    this.lastRawQuery = resp.search_plan?.raw_query || this.searchKeywords.join(\" \");\n    this.usedAiRanking = resp.metadata?.used_ai_ranking;\n    if (!this.results.length) {\n      const label = this.searchKeywords.length ? this.searchKeywords.join(\", \") : this.lastRawQuery || \"this query\";\n      this.info = `No profiles returned from LinkedIn for ${label}. Try adjusting personas or filters.`;\n    } else {\n      this.info = undefined;\n    }\n    this.loading = false;\n    this.clearJobState();\n  }\n  cappedMaxResults() {\n    const val = Number(this.autoMaxResults) || this.maxResultCap;\n    return Math.max(1, Math.min(val, this.maxResultCap));\n  }\n  fetchSync(payload) {\n    this.api.getSuggestedProfiles(payload).subscribe({\n      next: resp => this.applyResponse(resp),\n      error: err => {\n        this.handleRequestError(err?.error?.error || err.message || \"Match request failed\");\n      }\n    });\n  }\n  startAsyncJob(payload) {\n    this.clearJobState();\n    this.jobStatus = \"queued\";\n    this.info = \"AI ranking job queued. Results will appear once ready.\";\n    this.api.startSuggestedProfilesJob(payload).subscribe({\n      next: resp => {\n        this.jobId = resp.job_id;\n        this.jobStatus = \"running\";\n        this.pollJobStatus();\n      },\n      error: err => {\n        this.handleRequestError(err?.error?.error || err.message || \"Failed to queue AI job\");\n      }\n    });\n  }\n  pollJobStatus() {\n    if (!this.jobId) return;\n    this.api.getSuggestedProfilesJob(this.jobId).subscribe({\n      next: job => {\n        this.jobStatus = job.status;\n        if (job.status === \"completed\" && job.result) {\n          this.applyResponse(job.result);\n        } else if (job.status === \"failed\") {\n          this.handleRequestError(job.error || \"AI job failed\");\n          this.clearJobState();\n        } else {\n          this.jobPollHandle = setTimeout(() => this.pollJobStatus(), 1500);\n        }\n      },\n      error: err => {\n        this.handleRequestError(err?.error?.error || err.message || \"Failed to check AI job status\");\n        this.clearJobState();\n      }\n    });\n  }\n  clearJobState() {\n    if (this.jobPollHandle) {\n      clearTimeout(this.jobPollHandle);\n      this.jobPollHandle = undefined;\n    }\n    this.jobId = undefined;\n    this.jobStatus = undefined;\n  }\n  handleRequestError(message) {\n    this.error = message;\n    this.info = undefined;\n    this.searchPlanNote = undefined;\n    this.searchKeywords = [];\n    this.loading = false;\n  }\n};\nProfileUploadComponent = __decorate([Component({\n  selector: \"app-profile-upload\",\n  templateUrl: \"./profile-upload.component.html\",\n  styleUrls: [\"./profile-upload.component.scss\"]\n})], ProfileUploadComponent);\nexport { ProfileUploadComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}