{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/material/progress-spinner\";\nfunction ReportComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Generated \", i0.ɵɵpipeBind2(2, 1, ctx_r0.report == null ? null : ctx_r0.report.generated_at, \"short\"), \"\");\n  }\n}\nfunction ReportComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"mat-progress-spinner\", 11);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ReportComponent_div_13_p_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 2);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" High-risk churn by tolerance: low=\", (ctx_r0.report.summary_kpis.churn_by_tolerance == null ? null : ctx_r0.report.summary_kpis.churn_by_tolerance.low) || 0, \", medium=\", (ctx_r0.report.summary_kpis.churn_by_tolerance == null ? null : ctx_r0.report.summary_kpis.churn_by_tolerance.medium) || 0, \", high=\", (ctx_r0.report.summary_kpis.churn_by_tolerance == null ? null : ctx_r0.report.summary_kpis.churn_by_tolerance.high) || 0, \" \");\n  }\n}\nfunction ReportComponent_div_13_div_32_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const entry_r2 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", entry_r2[0], \" \\u2014 \", entry_r2[1].high, \" loans, $\", i0.ɵɵpipeBind2(2, 3, entry_r2[1].exposure, \"1.0-0\"), \" \");\n  }\n}\nfunction ReportComponent_div_13_div_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 2);\n    i0.ɵɵtext(2, \"High-risk by sector:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\", 14);\n    i0.ɵɵtemplate(4, ReportComponent_div_13_div_32_li_4_Template, 3, 6, \"li\", 15);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sectorEntries(ctx_r0.report.summary_kpis.sector_default));\n  }\n}\nfunction ReportComponent_div_13_li_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const inv_r3 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", inv_r3.name, \" - \", ctx_r0.formatPercent(inv_r3.probability), \" (\", inv_r3.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_13_li_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loan_r4 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate5(\" #\", loan_r4.id, \" in \", loan_r4.sector, \" - $\", i0.ɵɵpipeBind2(2, 5, loan_r4.amount, \"1.0-0\"), \" (\", ctx_r0.formatPercent(loan_r4.probability), \", \", loan_r4.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_13_mat_card_48_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const entry_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(entry_r5[0]);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(entry_r5[1].high);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$\", i0.ɵɵpipeBind2(7, 3, entry_r5[1].exposure, \"1.0-0\"), \"\");\n  }\n}\nfunction ReportComponent_div_13_mat_card_48_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\")(1, \"mat-card-title\");\n    i0.ɵɵtext(2, \"Sector Exposure (High Risk)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\")(4, \"thead\")(5, \"tr\")(6, \"th\");\n    i0.ɵɵtext(7, \"Sector\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"High-Risk Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Exposure\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, ReportComponent_div_13_mat_card_48_tr_13_Template, 8, 6, \"tr\", 15);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sectorEntries(ctx_r0.report.summary_kpis.sector_default));\n  }\n}\nfunction ReportComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 12)(2, \"mat-card\")(3, \"mat-card-title\");\n    i0.ɵɵtext(4, \"Investor Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"p\", 2);\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"number\");\n    i0.ɵɵpipe(14, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(15, ReportComponent_div_13_p_15_Template, 2, 3, \"p\", 13);\n    i0.ɵɵelementStart(16, \"p\", 2);\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"number\");\n    i0.ɵɵpipe(19, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"mat-card\")(21, \"mat-card-title\");\n    i0.ɵɵtext(22, \"Loan Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"p\");\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"p\");\n    i0.ɵɵtext(26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"p\");\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"p\", 2);\n    i0.ɵɵtext(30);\n    i0.ɵɵpipe(31, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(32, ReportComponent_div_13_div_32_Template, 5, 1, \"div\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"mat-card\")(34, \"mat-card-title\");\n    i0.ɵɵtext(35, \"Top Investors\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"ul\", 14);\n    i0.ɵɵtemplate(37, ReportComponent_div_13_li_37_Template, 2, 3, \"li\", 15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(38, \"mat-card\")(39, \"mat-card-title\");\n    i0.ɵɵtext(40, \"Top Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"ul\", 14);\n    i0.ɵɵtemplate(42, ReportComponent_div_13_li_42_Template, 3, 8, \"li\", 15);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(43, \"mat-card\", 16)(44, \"mat-card-title\");\n    i0.ɵɵtext(45, \"Full Report\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(46, \"pre\");\n    i0.ɵɵtext(47);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(48, ReportComponent_div_13_mat_card_48_Template, 14, 1, \"mat-card\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"High: \", ctx_r0.report.summary_kpis.investor_buckets.High, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Medium: \", ctx_r0.report.summary_kpis.investor_buckets.Medium, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Low: \", ctx_r0.report.summary_kpis.investor_buckets.Low, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Avg churn: \", i0.ɵɵpipeBind2(13, 17, ctx_r0.report.summary_kpis.avg_churn_risk, \"1.2-2\"), \" (prev: \", i0.ɵɵpipeBind2(14, 20, ctx_r0.report.summary_kpis.prev_day_avg_churn_risk, \"1.2-2\"), \") \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report.summary_kpis.churn_by_tolerance);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Engagement avg: \", i0.ɵɵpipeBind2(18, 23, ctx_r0.report.summary_kpis.engagement_avg, \"1.1-1\"), \" | Email open avg: \", i0.ɵɵpipeBind2(19, 26, ctx_r0.report.summary_kpis.email_open_avg, \"1.2-2\"), \" \");\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"High: \", ctx_r0.report.summary_kpis.loan_buckets.High, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Medium: \", ctx_r0.report.summary_kpis.loan_buckets.Medium, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Low: \", ctx_r0.report.summary_kpis.loan_buckets.Low, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"High-risk exposure: $\", i0.ɵɵpipeBind2(31, 29, ctx_r0.report.summary_kpis.high_default_exposure, \"1.0-0\"), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report.summary_kpis.sector_default);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_investors);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_loans);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.report_markdown);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report.summary_kpis.sector_default);\n  }\n}\nexport let ReportComponent = /*#__PURE__*/(() => {\n  class ReportComponent {\n    constructor(api, snackBar) {\n      this.api = api;\n      this.snackBar = snackBar;\n      this.loading = false;\n    }\n    ngOnInit() {\n      this.loadReport();\n    }\n    loadReport() {\n      this.loading = true;\n      // Refresh scores then generate a report to reduce backend training edge-cases.\n      this.api.batchRefresh().subscribe({\n        next: () => this.api.generateReport().subscribe({\n          next: report => {\n            this.report = report;\n            this.loading = false;\n          },\n          error: err => this.handleError(\"Failed to load report\", err)\n        }),\n        error: err => this.handleError(\"Failed to refresh scores\", err)\n      });\n    }\n    copyReport() {\n      if (!this.report) return;\n      navigator.clipboard.writeText(this.report.report_markdown).then(() => this.snackBar.open(\"Report copied to clipboard\", \"Close\", {\n        duration: 2000\n      })).catch(() => this.snackBar.open(\"Unable to copy\", \"Close\", {\n        duration: 2000\n      }));\n    }\n    formatPercent(value) {\n      if (value === undefined || value === null) return \"0.0%\";\n      return `${(value * 100).toFixed(1)}%`;\n    }\n    sectorEntries(sectorDefault) {\n      return Object.entries(sectorDefault || {});\n    }\n    handleError(message, err) {\n      console.error(message, err);\n      this.loading = false;\n      this.snackBar.open(message, \"Close\", {\n        duration: 3000\n      });\n    }\n    static {\n      this.ɵfac = function ReportComponent_Factory(t) {\n        return new (t || ReportComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ReportComponent,\n        selectors: [[\"app-report\"]],\n        decls: 14,\n        vars: 6,\n        consts: [[1, \"actions\"], [1, \"page-title\"], [1, \"muted\"], [1, \"action-buttons\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"mat-stroked-button\", \"\", \"color\", \"accent\", 3, \"click\", \"disabled\"], [\"class\", \"timestamp\", 4, \"ngIf\"], [\"class\", \"loading\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"timestamp\"], [1, \"loading\"], [\"mode\", \"indeterminate\", \"diameter\", \"40\"], [1, \"kpi-grid\"], [\"class\", \"muted\", 4, \"ngIf\"], [1, \"list\"], [4, \"ngFor\", \"ngForOf\"], [1, \"report-card\"]],\n        template: function ReportComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\")(2, \"div\", 1);\n            i0.ɵɵtext(3, \"Daily Risk & Engagement Report\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 2);\n            i0.ɵɵtext(5, \"Auto-generated summary for investor churn and loan default.\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"div\", 3)(7, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ReportComponent_Template_button_click_7_listener() {\n              return ctx.loadReport();\n            });\n            i0.ɵɵtext(8);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function ReportComponent_Template_button_click_9_listener() {\n              return ctx.copyReport();\n            });\n            i0.ɵɵtext(10, \" Copy to clipboard \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(11, ReportComponent_div_11_Template, 3, 4, \"div\", 6)(12, ReportComponent_div_12_Template, 2, 0, \"div\", 7)(13, ReportComponent_div_13_Template, 49, 32, \"div\", 8);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.loading ? \"Generating...\" : \"Generate Daily Report\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", !ctx.report);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.report);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.report && !ctx.loading);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.MatButton, i5.MatCard, i5.MatCardTitle, i6.MatProgressSpinner, i3.DecimalPipe, i3.DatePipe],\n        styles: [\".actions[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1rem;gap:.5rem;flex-wrap:wrap}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem}.timestamp[_ngcontent-%COMP%]{color:var(--muted);font-size:.95rem}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.kpi-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.75rem}.muted[_ngcontent-%COMP%]{color:var(--muted)}.list[_ngcontent-%COMP%]{padding-left:1rem;margin:.25rem 0}.report-card[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-wrap;background:var(--surface-2);padding:.75rem;border-radius:8px;border:1px solid var(--border);font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.6rem .35rem;border-bottom:1px solid var(--border);text-align:left}\"]\n      });\n    }\n  }\n  return ReportComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}