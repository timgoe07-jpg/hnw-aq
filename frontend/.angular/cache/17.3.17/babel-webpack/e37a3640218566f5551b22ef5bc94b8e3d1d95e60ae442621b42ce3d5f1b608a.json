{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/material/progress-spinner\";\nfunction ReportComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Generated \", i0.ɵɵpipeBind2(2, 1, ctx_r0.report == null ? null : ctx_r0.report.generated_at, \"short\"), \"\");\n  }\n}\nfunction ReportComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵelement(1, \"mat-progress-spinner\", 9);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ReportComponent_div_8_li_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const inv_r2 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", inv_r2.name, \" - \", ctx_r0.formatPercent(inv_r2.probability), \" (\", inv_r2.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_8_li_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loan_r3 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate5(\" #\", loan_r3.id, \" in \", loan_r3.sector, \" - $\", i0.ɵɵpipeBind2(2, 5, loan_r3.amount, \"1.0-0\"), \" (\", ctx_r0.formatPercent(loan_r3.probability), \", \", loan_r3.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 10)(2, \"mat-card\")(3, \"mat-card-title\");\n    i0.ɵɵtext(4, \"Investor Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"p\", 11);\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"number\");\n    i0.ɵɵpipe(14, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"mat-card\")(16, \"mat-card-title\");\n    i0.ɵɵtext(17, \"Loan Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"p\");\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"p\");\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"p\");\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"p\", 11);\n    i0.ɵɵtext(25);\n    i0.ɵɵpipe(26, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(27, \"mat-card\")(28, \"mat-card-title\");\n    i0.ɵɵtext(29, \"Top Investors\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"ul\", 12);\n    i0.ɵɵtemplate(31, ReportComponent_div_8_li_31_Template, 2, 3, \"li\", 13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(32, \"mat-card\")(33, \"mat-card-title\");\n    i0.ɵɵtext(34, \"Top Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"ul\", 12);\n    i0.ɵɵtemplate(36, ReportComponent_div_8_li_36_Template, 3, 8, \"li\", 13);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(37, \"mat-card\", 14)(38, \"mat-card-title\");\n    i0.ɵɵtext(39, \"Full Report\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"pre\");\n    i0.ɵɵtext(41);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"High: \", ctx_r0.report.summary_kpis.investor_buckets.High, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Medium: \", ctx_r0.report.summary_kpis.investor_buckets.Medium, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Low: \", ctx_r0.report.summary_kpis.investor_buckets.Low, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Avg churn: \", i0.ɵɵpipeBind2(13, 12, ctx_r0.report.summary_kpis.avg_churn_risk, \"1.2-2\"), \" (prev: \", i0.ɵɵpipeBind2(14, 15, ctx_r0.report.summary_kpis.prev_day_avg_churn_risk, \"1.2-2\"), \") \");\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"High: \", ctx_r0.report.summary_kpis.loan_buckets.High, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Medium: \", ctx_r0.report.summary_kpis.loan_buckets.Medium, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Low: \", ctx_r0.report.summary_kpis.loan_buckets.Low, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"High-risk exposure: $\", i0.ɵɵpipeBind2(26, 18, ctx_r0.report.summary_kpis.high_default_exposure, \"1.0-0\"), \"\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_investors);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_loans);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.report_markdown);\n  }\n}\nexport let ReportComponent = /*#__PURE__*/(() => {\n  class ReportComponent {\n    constructor(api, snackBar) {\n      this.api = api;\n      this.snackBar = snackBar;\n      this.loading = false;\n    }\n    ngOnInit() {\n      this.loadReport();\n    }\n    loadReport() {\n      this.loading = true;\n      // Refresh scores then generate a report to reduce backend training edge-cases.\n      this.api.batchRefresh().subscribe({\n        next: () => this.api.generateReport().subscribe({\n          next: report => {\n            this.report = report;\n            this.loading = false;\n          },\n          error: err => this.handleError(\"Failed to load report\", err)\n        }),\n        error: err => this.handleError(\"Failed to refresh scores\", err)\n      });\n    }\n    copyReport() {\n      if (!this.report) return;\n      navigator.clipboard.writeText(this.report.report_markdown).then(() => this.snackBar.open(\"Report copied to clipboard\", \"Close\", {\n        duration: 2000\n      })).catch(() => this.snackBar.open(\"Unable to copy\", \"Close\", {\n        duration: 2000\n      }));\n    }\n    formatPercent(value) {\n      if (value === undefined || value === null) return \"0.0%\";\n      return `${(value * 100).toFixed(1)}%`;\n    }\n    handleError(message, err) {\n      console.error(message, err);\n      this.loading = false;\n      this.snackBar.open(message, \"Close\", {\n        duration: 3000\n      });\n    }\n    static {\n      this.ɵfac = function ReportComponent_Factory(t) {\n        return new (t || ReportComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ReportComponent,\n        selectors: [[\"app-report\"]],\n        decls: 9,\n        vars: 6,\n        consts: [[1, \"actions\"], [1, \"left\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"mat-stroked-button\", \"\", \"color\", \"accent\", 2, \"margin-left\", \"0.5rem\", 3, \"click\", \"disabled\"], [\"class\", \"timestamp\", 4, \"ngIf\"], [\"class\", \"loading\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"timestamp\"], [1, \"loading\"], [\"mode\", \"indeterminate\", \"diameter\", \"40\"], [1, \"kpi-grid\"], [1, \"muted\"], [1, \"list\"], [4, \"ngFor\", \"ngForOf\"], [1, \"report-card\"]],\n        template: function ReportComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n            i0.ɵɵlistener(\"click\", function ReportComponent_Template_button_click_2_listener() {\n              return ctx.loadReport();\n            });\n            i0.ɵɵtext(3);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"button\", 3);\n            i0.ɵɵlistener(\"click\", function ReportComponent_Template_button_click_4_listener() {\n              return ctx.copyReport();\n            });\n            i0.ɵɵtext(5, \" Copy to clipboard \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(6, ReportComponent_div_6_Template, 3, 4, \"div\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(7, ReportComponent_div_7_Template, 2, 0, \"div\", 5)(8, ReportComponent_div_8_Template, 42, 21, \"div\", 6);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.loading ? \"Generating...\" : \"Generate Daily Report\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", !ctx.report);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.report);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.report && !ctx.loading);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.MatButton, i5.MatCard, i5.MatCardTitle, i6.MatProgressSpinner, i3.DecimalPipe, i3.DatePipe],\n        styles: [\".actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;gap:.5rem}.timestamp[_ngcontent-%COMP%]{color:var(--muted);font-size:.95rem}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.kpi-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.75rem}.muted[_ngcontent-%COMP%]{color:var(--muted)}.list[_ngcontent-%COMP%]{padding-left:1rem;margin:.25rem 0}.report-card[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-wrap;background:var(--surface-2);padding:.75rem;border-radius:8px;border:1px solid var(--border);font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace}\"]\n      });\n    }\n  }\n  return ReportComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}