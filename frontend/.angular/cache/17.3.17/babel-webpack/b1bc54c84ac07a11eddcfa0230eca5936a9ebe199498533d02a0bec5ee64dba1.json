{"ast":null,"code":"import { forkJoin } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/card\";\nimport * as i6 from \"@angular/material/progress-spinner\";\nfunction DashboardComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Generated \", i0.ɵɵpipeBind2(2, 1, ctx_r0.report == null ? null : ctx_r0.report.generated_at, \"short\"), \"\");\n  }\n}\nfunction DashboardComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵelement(1, \"mat-progress-spinner\", 10);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_8_table_49_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"span\", 24);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const inv_r2 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r2.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.formatPercent(inv_r2.probability));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", inv_r2.bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(inv_r2.bucket);\n  }\n}\nfunction DashboardComponent_div_8_table_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 22)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Bucket\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"tbody\");\n    i0.ɵɵtemplate(10, DashboardComponent_div_8_table_49_tr_10_Template, 8, 4, \"tr\", 23);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.topInvestors());\n  }\n}\nfunction DashboardComponent_div_8_ng_template_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"No investors found.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_8_table_55_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\")(11, \"span\", 24);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const loan_r3 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"#\", loan_r3.id, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(loan_r3.sector);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$\", i0.ɵɵpipeBind2(7, 6, loan_r3.amount, \"1.0-0\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.formatPercent(loan_r3.probability));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", loan_r3.bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(loan_r3.bucket);\n  }\n}\nfunction DashboardComponent_div_8_table_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 22)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Sector\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Amount\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Bucket\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"tbody\");\n    i0.ɵɵtemplate(14, DashboardComponent_div_8_table_55_tr_14_Template, 13, 9, \"tr\", 23);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(14);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.topLoans());\n  }\n}\nfunction DashboardComponent_div_8_ng_template_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"No loans found.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_8_pre_61_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"pre\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.report.report_markdown);\n  }\n}\nfunction DashboardComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"mat-card\", 12)(2, \"mat-card-title\");\n    i0.ɵɵtext(3, \"Investor Churn Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 13)(5, \"div\", 14)(6, \"div\");\n    i0.ɵɵtext(7, \"High\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 15);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"div\", 16)(11, \"div\");\n    i0.ɵɵtext(12, \"Medium\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 15);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"div\", 17)(16, \"div\");\n    i0.ɵɵtext(17, \"Low\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\", 15);\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(20, \"p\", 18);\n    i0.ɵɵtext(21);\n    i0.ɵɵpipe(22, \"number\");\n    i0.ɵɵpipe(23, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"mat-card\", 12)(25, \"mat-card-title\");\n    i0.ɵɵtext(26, \"Loan Default Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"div\", 13)(28, \"div\", 14)(29, \"div\");\n    i0.ɵɵtext(30, \"High\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"div\", 15);\n    i0.ɵɵtext(32);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(33, \"div\", 16)(34, \"div\");\n    i0.ɵɵtext(35, \"Medium\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"div\", 15);\n    i0.ɵɵtext(37);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(38, \"div\", 17)(39, \"div\");\n    i0.ɵɵtext(40, \"Low\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"div\", 15);\n    i0.ɵɵtext(42);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(43, \"p\", 18);\n    i0.ɵɵtext(44);\n    i0.ɵɵpipe(45, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(46, \"mat-card\", 19)(47, \"mat-card-title\");\n    i0.ɵɵtext(48, \"Top At-Risk Investors\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(49, DashboardComponent_div_8_table_49_Template, 11, 1, \"table\", 20)(50, DashboardComponent_div_8_ng_template_50_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(52, \"mat-card\", 19)(53, \"mat-card-title\");\n    i0.ɵɵtext(54, \"Top At-Risk Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(55, DashboardComponent_div_8_table_55_Template, 15, 1, \"table\", 20)(56, DashboardComponent_div_8_ng_template_56_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(58, \"mat-card\", 19)(59, \"mat-card-title\");\n    i0.ɵɵtext(60, \"Report Preview\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(61, DashboardComponent_div_8_pre_61_Template, 2, 1, \"pre\", 21);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const noInvestors_r4 = i0.ɵɵreference(51);\n    const noLoans_r5 = i0.ɵɵreference(57);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate(ctx_r0.investorBuckets().High);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.investorBuckets().Medium);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.investorBuckets().Low);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Avg churn risk: \", i0.ɵɵpipeBind2(22, 14, ctx_r0.report == null ? null : ctx_r0.report.summary_kpis.avg_churn_risk, \"1.2-2\"), \" (prev: \", i0.ɵɵpipeBind2(23, 17, ctx_r0.report == null ? null : ctx_r0.report.summary_kpis.prev_day_avg_churn_risk, \"1.2-2\"), \") \");\n    i0.ɵɵadvance(11);\n    i0.ɵɵtextInterpolate(ctx_r0.loanBuckets().High);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.loanBuckets().Medium);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.loanBuckets().Low);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" High-risk exposure: $\", i0.ɵɵpipeBind2(45, 20, ctx_r0.report == null ? null : ctx_r0.report.summary_kpis.high_default_exposure, \"1.0-0\"), \" \");\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.topInvestors().length)(\"ngIfElse\", noInvestors_r4);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.topLoans().length)(\"ngIfElse\", noLoans_r5);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report);\n  }\n}\nexport let DashboardComponent = /*#__PURE__*/(() => {\n  class DashboardComponent {\n    constructor(api, snackBar) {\n      this.api = api;\n      this.snackBar = snackBar;\n      this.investors = [];\n      this.loans = [];\n      this.loading = false;\n    }\n    ngOnInit() {\n      this.loadData();\n    }\n    loadData() {\n      this.loading = true;\n      this.api.batchRefresh().subscribe({\n        next: () => {\n          forkJoin({\n            investors: this.api.getInvestors(),\n            loans: this.api.getLoans(),\n            report: this.api.generateReport()\n          }).subscribe({\n            next: ({\n              investors,\n              loans,\n              report\n            }) => {\n              this.investors = investors.items;\n              this.loans = loans.items;\n              this.report = report;\n              this.loading = false;\n            },\n            error: err => this.handleError(\"Failed to load dashboard data\", err)\n          });\n        },\n        error: err => this.handleError(\"Failed to refresh scores\", err)\n      });\n    }\n    refreshReport() {\n      this.loading = true;\n      this.api.generateReport().subscribe({\n        next: report => {\n          this.report = report;\n          this.loading = false;\n          this.snackBar.open(\"Report refreshed\", \"Close\", {\n            duration: 2000\n          });\n        },\n        error: err => this.handleError(\"Failed to refresh report\", err)\n      });\n    }\n    investorBuckets() {\n      return this.report?.summary_kpis.investor_buckets || {\n        Low: 0,\n        Medium: 0,\n        High: 0\n      };\n    }\n    loanBuckets() {\n      return this.report?.summary_kpis.loan_buckets || {\n        Low: 0,\n        Medium: 0,\n        High: 0\n      };\n    }\n    topInvestors() {\n      return this.report?.summary_kpis.top_investors || [];\n    }\n    topLoans() {\n      return this.report?.summary_kpis.top_loans || [];\n    }\n    formatPercent(prob) {\n      if (prob === undefined || prob === null) {\n        return \"0.0%\";\n      }\n      return `${(prob * 100).toFixed(1)}%`;\n    }\n    handleError(message, err) {\n      console.error(message, err);\n      this.loading = false;\n      this.snackBar.open(message, \"Close\", {\n        duration: 3000\n      });\n    }\n    static {\n      this.ɵfac = function DashboardComponent_Factory(t) {\n        return new (t || DashboardComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardComponent,\n        selectors: [[\"app-dashboard\"]],\n        decls: 9,\n        vars: 5,\n        consts: [[\"noInvestors\", \"\"], [\"noLoans\", \"\"], [1, \"actions\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"mat-stroked-button\", \"\", \"color\", \"accent\", 2, \"margin-left\", \"0.5rem\", 3, \"click\", \"disabled\"], [\"class\", \"timestamp\", 4, \"ngIf\"], [\"class\", \"loading\", 4, \"ngIf\"], [\"class\", \"grid\", 4, \"ngIf\"], [1, \"timestamp\"], [1, \"loading\"], [\"mode\", \"indeterminate\", \"diameter\", \"40\"], [1, \"grid\"], [1, \"summary-card\"], [1, \"bucket-row\"], [1, \"bucket\", \"high\"], [1, \"value\"], [1, \"bucket\", \"medium\"], [1, \"bucket\", \"low\"], [1, \"subtitle\"], [1, \"wide-card\"], [\"class\", \"data-table\", 4, \"ngIf\", \"ngIfElse\"], [\"class\", \"report-text\", 4, \"ngIf\"], [1, \"data-table\"], [4, \"ngFor\", \"ngForOf\"], [1, \"chip\", 3, \"ngClass\"], [1, \"muted\"], [1, \"report-text\"]],\n        template: function DashboardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\")(2, \"button\", 3);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_button_click_2_listener() {\n              return ctx.refreshReport();\n            });\n            i0.ɵɵtext(3, \"Generate Report\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_button_click_4_listener() {\n              return ctx.loadData();\n            });\n            i0.ɵɵtext(5, \" Refresh Data \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(6, DashboardComponent_div_6_Template, 3, 4, \"div\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(7, DashboardComponent_div_7_Template, 2, 0, \"div\", 6)(8, DashboardComponent_div_8_Template, 62, 23, \"div\", 7);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.report);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i4.MatButton, i5.MatCard, i5.MatCardTitle, i6.MatProgressSpinner, i3.DecimalPipe, i3.DatePipe],\n        styles: [\".actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;gap:.5rem}.timestamp[_ngcontent-%COMP%]{color:var(--muted);font-size:.95rem}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}.summary-card[_ngcontent-%COMP%]   .bucket-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;margin-top:.5rem}.bucket[_ngcontent-%COMP%]{padding:.75rem;border-radius:8px;background:var(--surface-2);border:1px solid var(--border)}.bucket.high[_ngcontent-%COMP%]{border-color:#ef4444;color:#ef4444}.bucket.medium[_ngcontent-%COMP%]{border-color:#f59e0b;color:#f59e0b}.bucket.low[_ngcontent-%COMP%]{border-color:#22c55e;color:#22c55e}.bucket[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.subtitle[_ngcontent-%COMP%]{margin-top:.75rem;color:var(--muted)}.wide-card[_ngcontent-%COMP%]{grid-column:1/-1}.data-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.data-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:left;padding:.6rem .35rem;border-bottom:1px solid var(--border)}.chip[_ngcontent-%COMP%]{padding:.2rem .5rem;border-radius:999px;font-size:.85rem;text-transform:capitalize}.chip.high[_ngcontent-%COMP%]{background:#ef444433;color:#ef4444}.chip.medium[_ngcontent-%COMP%]{background:#f59e0b26;color:#f59e0b}.chip.low[_ngcontent-%COMP%]{background:#22c55e26;color:#22c55e}.muted[_ngcontent-%COMP%]{color:var(--muted)}.report-text[_ngcontent-%COMP%]{white-space:pre-wrap;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;background:var(--surface-2);padding:.75rem;border-radius:8px;border:1px solid var(--border)}\"]\n      });\n    }\n  }\n  return DashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}