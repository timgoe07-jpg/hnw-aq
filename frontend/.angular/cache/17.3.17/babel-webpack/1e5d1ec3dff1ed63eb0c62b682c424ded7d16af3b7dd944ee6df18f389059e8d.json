{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/card\";\nimport * as i7 from \"@angular/material/form-field\";\nimport * as i8 from \"@angular/material/input\";\nimport * as i9 from \"@angular/material/progress-spinner\";\nimport * as i10 from \"ng2-charts\";\nconst _c0 = () => ({\n  color: \"#9bb0c9\"\n});\nconst _c1 = a0 => ({\n  labels: a0\n});\nconst _c2 = a0 => ({\n  legend: a0\n});\nconst _c3 = a0 => ({\n  ticks: a0\n});\nconst _c4 = a0 => ({\n  ticks: a0,\n  beginAtZero: true\n});\nconst _c5 = (a0, a1) => ({\n  x: a0,\n  y: a1\n});\nconst _c6 = (a0, a1) => ({\n  responsive: true,\n  plugins: a0,\n  scales: a1\n});\nfunction ReportComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Generated \", i0.ɵɵpipeBind2(2, 1, ctx_r0.report == null ? null : ctx_r0.report.generated_at, \"short\"), \"\");\n  }\n}\nfunction ReportComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"mat-progress-spinner\", 11);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ReportComponent_div_13_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" High-risk churn by tolerance: low=\", (ctx_r0.report.summary_kpis.churn_by_tolerance == null ? null : ctx_r0.report.summary_kpis.churn_by_tolerance.low) || 0, \", medium=\", (ctx_r0.report.summary_kpis.churn_by_tolerance == null ? null : ctx_r0.report.summary_kpis.churn_by_tolerance.medium) || 0, \", high=\", (ctx_r0.report.summary_kpis.churn_by_tolerance == null ? null : ctx_r0.report.summary_kpis.churn_by_tolerance.high) || 0, \" \");\n  }\n}\nfunction ReportComponent_div_13_div_59_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const entry_r3 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", entry_r3[0], \" \\u2014 \", entry_r3[1].high, \" loans, $\", i0.ɵɵpipeBind2(2, 3, entry_r3[1].exposure, \"1.0-0\"), \" \");\n  }\n}\nfunction ReportComponent_div_13_div_59_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 2);\n    i0.ɵɵtext(2, \"High-risk by sector:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\", 20);\n    i0.ɵɵtemplate(4, ReportComponent_div_13_div_59_li_4_Template, 3, 6, \"li\", 21);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sectorEntries(ctx_r0.report.summary_kpis.sector_default));\n  }\n}\nfunction ReportComponent_div_13_li_64_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const inv_r4 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", inv_r4.name, \" - \", ctx_r0.formatPercent(inv_r4.probability), \" (\", inv_r4.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_13_li_69_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loan_r5 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate5(\" #\", loan_r5.id, \" in \", loan_r5.sector, \" - $\", i0.ɵɵpipeBind2(2, 5, loan_r5.amount, \"1.0-0\"), \" (\", ctx_r0.formatPercent(loan_r5.probability), \", \", loan_r5.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_13_mat_card_85_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const entry_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(entry_r6[0]);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(entry_r6[1].high);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$\", i0.ɵɵpipeBind2(7, 3, entry_r6[1].exposure, \"1.0-0\"), \"\");\n  }\n}\nfunction ReportComponent_div_13_mat_card_85_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\")(1, \"mat-card-title\");\n    i0.ɵɵtext(2, \"Sector Exposure (High Risk)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\")(4, \"thead\")(5, \"tr\")(6, \"th\");\n    i0.ɵɵtext(7, \"Sector\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"High-Risk Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Exposure\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, ReportComponent_div_13_mat_card_85_tr_13_Template, 8, 6, \"tr\", 21);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sectorEntries(ctx_r0.report.summary_kpis.sector_default));\n  }\n}\nfunction ReportComponent_div_13_li_94_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const inv_r7 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", inv_r7.name, \" \\u2014 \", ctx_r0.formatPercent(inv_r7.probability), \" (\", inv_r7.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_13_li_99_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loan_r8 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate5(\" #\", loan_r8.id, \" \", loan_r8.sector, \" \\u2014 $\", i0.ɵɵpipeBind2(2, 5, loan_r8.amount, \"1.0-0\"), \" (\", ctx_r0.formatPercent(loan_r8.probability), \", \", loan_r8.bucket, \") \");\n  }\n}\nfunction ReportComponent_div_13_div_109_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.aiAnswer, \" \");\n  }\n}\nfunction ReportComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 12)(2, \"mat-card\", 13)(3, \"mat-card-title\");\n    i0.ɵɵtext(4, \"Investor Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 14)(6, \"div\")(7, \"div\", 15);\n    i0.ɵɵtext(8, \"High\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 16);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\")(12, \"div\", 15);\n    i0.ɵɵtext(13, \"Medium\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 17);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\")(17, \"div\", 15);\n    i0.ɵɵtext(18, \"Low\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 18);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(21, \"div\", 2);\n    i0.ɵɵtext(22);\n    i0.ɵɵpipe(23, \"number\");\n    i0.ɵɵpipe(24, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(25, ReportComponent_div_13_div_25_Template, 2, 3, \"div\", 19);\n    i0.ɵɵelementStart(26, \"div\", 2);\n    i0.ɵɵtext(27);\n    i0.ɵɵpipe(28, \"number\");\n    i0.ɵɵpipe(29, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"div\", 2);\n    i0.ɵɵtext(31);\n    i0.ɵɵpipe(32, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(33, \"mat-card\", 13)(34, \"mat-card-title\");\n    i0.ɵɵtext(35, \"Loan Buckets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"div\", 14)(37, \"div\")(38, \"div\", 15);\n    i0.ɵɵtext(39, \"High\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"div\", 16);\n    i0.ɵɵtext(41);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(42, \"div\")(43, \"div\", 15);\n    i0.ɵɵtext(44, \"Medium\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"div\", 17);\n    i0.ɵɵtext(46);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(47, \"div\")(48, \"div\", 15);\n    i0.ɵɵtext(49, \"Low\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"div\", 18);\n    i0.ɵɵtext(51);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(52, \"div\", 2);\n    i0.ɵɵtext(53);\n    i0.ɵɵpipe(54, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(55, \"div\", 2);\n    i0.ɵɵtext(56);\n    i0.ɵɵpipe(57, \"number\");\n    i0.ɵɵpipe(58, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(59, ReportComponent_div_13_div_59_Template, 5, 1, \"div\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(60, \"mat-card\", 13)(61, \"mat-card-title\");\n    i0.ɵɵtext(62, \"Top Investors\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(63, \"ul\", 20);\n    i0.ɵɵtemplate(64, ReportComponent_div_13_li_64_Template, 2, 3, \"li\", 21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(65, \"mat-card\", 13)(66, \"mat-card-title\");\n    i0.ɵɵtext(67, \"Top Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(68, \"ul\", 20);\n    i0.ɵɵtemplate(69, ReportComponent_div_13_li_69_Template, 3, 8, \"li\", 21);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(70, \"mat-card\", 22)(71, \"mat-card-title\");\n    i0.ɵɵtext(72, \"Full Report\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(73, \"pre\");\n    i0.ɵɵtext(74);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(75, \"div\", 23)(76, \"mat-card\")(77, \"mat-card-title\");\n    i0.ɵɵtext(78, \"Engagement Trend\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(79, \"canvas\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(80, \"mat-card\")(81, \"mat-card-title\");\n    i0.ɵɵtext(82, \"DSCR Trend\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(83, \"canvas\", 24);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(84, \"div\", 25);\n    i0.ɵɵtemplate(85, ReportComponent_div_13_mat_card_85_Template, 14, 1, \"mat-card\", 8);\n    i0.ɵɵelementStart(86, \"mat-card\")(87, \"mat-card-title\");\n    i0.ɵɵtext(88, \"Top Investors & Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(89, \"div\", 26)(90, \"div\")(91, \"div\", 2);\n    i0.ɵɵtext(92, \"Investors\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(93, \"ul\", 20);\n    i0.ɵɵtemplate(94, ReportComponent_div_13_li_94_Template, 2, 3, \"li\", 21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(95, \"div\")(96, \"div\", 2);\n    i0.ɵɵtext(97, \"Loans\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(98, \"ul\", 20);\n    i0.ɵɵtemplate(99, ReportComponent_div_13_li_99_Template, 3, 8, \"li\", 21);\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(100, \"mat-card\", 27)(101, \"mat-card-title\");\n    i0.ɵɵtext(102, \"Explain with AI\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(103, \"mat-form-field\", 28)(104, \"mat-label\");\n    i0.ɵɵtext(105, \"Ask about the report\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(106, \"textarea\", 29);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ReportComponent_div_13_Template_textarea_ngModelChange_106_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r0.aiQuestion, $event) || (ctx_r0.aiQuestion = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(107, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function ReportComponent_div_13_Template_button_click_107_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.askAi());\n    });\n    i0.ɵɵtext(108);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(109, ReportComponent_div_13_div_109_Template, 2, 1, \"div\", 30);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵtextInterpolate(ctx_r0.report.summary_kpis.investor_buckets.High);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.summary_kpis.investor_buckets.Medium);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.summary_kpis.investor_buckets.Low);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Avg churn: \", i0.ɵɵpipeBind2(23, 32, ctx_r0.report.summary_kpis.avg_churn_risk, \"1.2-2\"), \" (prev: \", i0.ɵɵpipeBind2(24, 35, ctx_r0.report.summary_kpis.prev_day_avg_churn_risk, \"1.2-2\"), \") \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report.summary_kpis.churn_by_tolerance);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Engagement avg: \", i0.ɵɵpipeBind2(28, 38, ctx_r0.report.summary_kpis.engagement_avg, \"1.1-1\"), \" | Email open avg: \", i0.ɵɵpipeBind2(29, 41, ctx_r0.report.summary_kpis.email_open_avg, \"1.2-2\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" Distribution yield p50: \", i0.ɵɵpipeBind2(32, 44, ctx_r0.report.summary_kpis.distribution_yield == null ? null : ctx_r0.report.summary_kpis.distribution_yield.p50, \"1.2-2\"), \" \");\n    i0.ɵɵadvance(10);\n    i0.ɵɵtextInterpolate(ctx_r0.report.summary_kpis.loan_buckets.High);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.summary_kpis.loan_buckets.Medium);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.summary_kpis.loan_buckets.Low);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"High-risk exposure: $\", i0.ɵɵpipeBind2(54, 47, ctx_r0.report.summary_kpis.high_default_exposure, \"1.0-0\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" DSCR p50: \", i0.ɵɵpipeBind2(57, 50, ctx_r0.report.summary_kpis.dscr == null ? null : ctx_r0.report.summary_kpis.dscr.p50, \"1.2-2\"), \" | p25: \", i0.ɵɵpipeBind2(58, 53, ctx_r0.report.summary_kpis.dscr == null ? null : ctx_r0.report.summary_kpis.dscr.p25, \"1.2-2\"), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report.summary_kpis.sector_default);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_investors);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_loans);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.report.report_markdown);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"data\", ctx_r0.trendEngagement)(\"options\", i0.ɵɵpureFunction2(70, _c6, i0.ɵɵpureFunction1(59, _c2, i0.ɵɵpureFunction1(57, _c1, i0.ɵɵpureFunction0(56, _c0))), i0.ɵɵpureFunction2(67, _c5, i0.ɵɵpureFunction1(62, _c3, i0.ɵɵpureFunction0(61, _c0)), i0.ɵɵpureFunction1(65, _c4, i0.ɵɵpureFunction0(64, _c0)))))(\"type\", \"line\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"data\", ctx_r0.trendDscr)(\"options\", i0.ɵɵpureFunction2(87, _c6, i0.ɵɵpureFunction1(76, _c2, i0.ɵɵpureFunction1(74, _c1, i0.ɵɵpureFunction0(73, _c0))), i0.ɵɵpureFunction2(84, _c5, i0.ɵɵpureFunction1(79, _c3, i0.ɵɵpureFunction0(78, _c0)), i0.ɵɵpureFunction1(82, _c4, i0.ɵɵpureFunction0(81, _c0)))))(\"type\", \"line\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.report.summary_kpis.sector_default);\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_investors);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.report.summary_kpis.top_loans);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r0.aiQuestion);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.aiLoading || !ctx_r0.aiQuestion);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.aiLoading ? \"Thinking...\" : \"Ask AI\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.aiAnswer);\n  }\n}\nexport let ReportComponent = /*#__PURE__*/(() => {\n  class ReportComponent {\n    constructor(api, snackBar) {\n      this.api = api;\n      this.snackBar = snackBar;\n      this.loading = false;\n      this.trendEngagement = {\n        labels: [],\n        datasets: []\n      };\n      this.trendDscr = {\n        labels: [],\n        datasets: []\n      };\n      this.aiQuestion = \"\";\n      this.aiAnswer = \"\";\n      this.aiLoading = false;\n      this.aiHistory = [];\n      this.aiOpen = true;\n    }\n    ngOnInit() {\n      this.loadReport();\n    }\n    loadReport() {\n      this.loading = true;\n      // Refresh scores then generate a report to reduce backend training edge-cases.\n      this.api.batchRefresh().subscribe({\n        next: () => this.api.generateReport().subscribe({\n          next: report => {\n            this.report = report;\n            this.trendEngagement = this.toTrendData(report.summary_kpis.engagement_trend || [], \"Engagement\");\n            this.trendDscr = this.toTrendData(report.summary_kpis.dscr_trend || [], \"DSCR\");\n            this.loading = false;\n          },\n          error: err => this.handleError(\"Failed to load report\", err)\n        }),\n        error: err => this.handleError(\"Failed to refresh scores\", err)\n      });\n    }\n    copyReport() {\n      if (!this.report) return;\n      navigator.clipboard.writeText(this.report.report_markdown).then(() => this.snackBar.open(\"Report copied to clipboard\", \"Close\", {\n        duration: 2000\n      })).catch(() => this.snackBar.open(\"Unable to copy\", \"Close\", {\n        duration: 2000\n      }));\n    }\n    formatPercent(value) {\n      if (value === undefined || value === null) return \"0.0%\";\n      return `${(value * 100).toFixed(1)}%`;\n    }\n    sectorEntries(sectorDefault) {\n      return Object.entries(sectorDefault || {});\n    }\n    // Expose calibration data for UI (used if we surface it)\n    getCalibration(modelMetrics) {\n      return modelMetrics?.calibration || {};\n    }\n    toTrendData(series, label) {\n      const labels = series.map((_, idx) => `t${idx + 1}`);\n      return {\n        labels,\n        datasets: [{\n          data: series,\n          label,\n          borderColor: \"#19c3b1\",\n          backgroundColor: \"rgba(25,195,177,0.2)\",\n          tension: 0.25,\n          fill: true\n        }]\n      };\n    }\n    askAi() {\n      if (!this.aiQuestion) return;\n      this.aiLoading = true;\n      this.aiHistory.push({\n        role: \"user\",\n        content: this.aiQuestion\n      });\n      const context = {\n        report: this.report,\n        trends: {\n          engagement: this.trendEngagement,\n          dscr: this.trendDscr\n        }\n      };\n      this.api.askAi(this.aiQuestion, \"report\", context, this.aiHistory).subscribe({\n        next: resp => {\n          this.aiAnswer = resp.answer;\n          this.aiHistory.push({\n            role: \"assistant\",\n            content: resp.answer\n          });\n          this.aiLoading = false;\n          this.aiQuestion = \"\";\n        },\n        error: err => this.handleError(\"AI explanation failed\", err)\n      });\n    }\n    handleError(message, err) {\n      console.error(message, err);\n      this.loading = false;\n      this.snackBar.open(message, \"Close\", {\n        duration: 3000\n      });\n    }\n    static {\n      this.ɵfac = function ReportComponent_Factory(t) {\n        return new (t || ReportComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ReportComponent,\n        selectors: [[\"app-report\"]],\n        decls: 14,\n        vars: 6,\n        consts: [[1, \"actions\"], [1, \"page-title\"], [1, \"muted\"], [1, \"action-buttons\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"mat-stroked-button\", \"\", \"color\", \"accent\", 3, \"click\", \"disabled\"], [\"class\", \"timestamp\", 4, \"ngIf\"], [\"class\", \"loading\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"timestamp\"], [1, \"loading\"], [\"mode\", \"indeterminate\", \"diameter\", \"40\"], [1, \"kpi-grid\"], [1, \"stat-card\"], [1, \"stat-row\"], [1, \"label\"], [1, \"value\", \"danger\"], [1, \"value\", \"warn\"], [1, \"value\", \"success\"], [\"class\", \"muted\", 4, \"ngIf\"], [1, \"list\"], [4, \"ngFor\", \"ngForOf\"], [1, \"report-card\"], [1, \"grid\", \"trend-grid\"], [\"baseChart\", \"\", 3, \"data\", \"options\", \"type\"], [1, \"grid\"], [1, \"side-by-side\"], [1, \"ai-card\"], [\"appearance\", \"fill\", 1, \"full-width\"], [\"matInput\", \"\", \"rows\", \"3\", \"placeholder\", \"e.g., What should we action first?\", 3, \"ngModelChange\", \"ngModel\"], [\"class\", \"ai-answer\", 4, \"ngIf\"], [1, \"ai-answer\"]],\n        template: function ReportComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\")(2, \"div\", 1);\n            i0.ɵɵtext(3, \"Daily Risk & Engagement Report\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 2);\n            i0.ɵɵtext(5, \"Auto-generated summary for investor churn and loan default.\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"div\", 3)(7, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function ReportComponent_Template_button_click_7_listener() {\n              return ctx.loadReport();\n            });\n            i0.ɵɵtext(8);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function ReportComponent_Template_button_click_9_listener() {\n              return ctx.copyReport();\n            });\n            i0.ɵɵtext(10, \" Copy to clipboard \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(11, ReportComponent_div_11_Template, 3, 4, \"div\", 6)(12, ReportComponent_div_12_Template, 2, 0, \"div\", 7)(13, ReportComponent_div_13_Template, 110, 90, \"div\", 8);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.loading ? \"Generating...\" : \"Generate Daily Report\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", !ctx.report);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.report);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.report && !ctx.loading);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, i5.MatButton, i6.MatCard, i6.MatCardTitle, i7.MatFormField, i7.MatLabel, i8.MatInput, i9.MatProgressSpinner, i10.BaseChartDirective, i3.DecimalPipe, i3.DatePipe],\n        styles: [\".actions[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1rem;gap:.5rem;flex-wrap:wrap}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem}.timestamp[_ngcontent-%COMP%]{color:var(--muted);font-size:.95rem}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.kpi-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.75rem}.muted[_ngcontent-%COMP%]{color:var(--muted)}.list[_ngcontent-%COMP%]{padding-left:1rem;margin:.25rem 0}.report-card[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-wrap;background:var(--surface-2);padding:.75rem;border-radius:8px;border:1px solid var(--border);font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;max-height:320px;overflow:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.6rem .35rem;border-bottom:1px solid var(--border);text-align:left}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:.75rem}.side-by-side[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.5rem}.stat-card[_ngcontent-%COMP%]   .stat-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:.75rem;margin-bottom:.35rem}.stat-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--muted);font-size:.8rem}.stat-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700}.value.danger[_ngcontent-%COMP%]{color:#ef4444}.value.warn[_ngcontent-%COMP%]{color:#f59e0b}.value.success[_ngcontent-%COMP%]{color:#22c55e}.trend-grid[_ngcontent-%COMP%]{margin:.5rem 0 1rem}.ai-card[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.ai-answer[_ngcontent-%COMP%]{margin-top:.75rem;padding:.75rem;border-radius:8px;background:var(--surface-2);border:1px solid var(--border);white-space:pre-wrap}\"]\n      });\n    }\n  }\n  return ReportComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}