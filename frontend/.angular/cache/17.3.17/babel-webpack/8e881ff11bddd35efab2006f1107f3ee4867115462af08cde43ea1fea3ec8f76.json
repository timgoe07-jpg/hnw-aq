{"ast":null,"code":"import { Validators } from \"@angular/forms\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/api.service\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/card\";\nimport * as i7 from \"@angular/material/form-field\";\nimport * as i8 from \"@angular/material/input\";\nimport * as i9 from \"@angular/material/select\";\nimport * as i10 from \"@angular/material/core\";\nimport * as i11 from \"ng2-charts\";\nimport * as i12 from \"@angular/material/slider\";\nconst _c0 = () => ({\n  display: false\n});\nconst _c1 = a0 => ({\n  legend: a0\n});\nconst _c2 = () => ({\n  color: \"#9bb0c9\"\n});\nconst _c3 = a0 => ({\n  ticks: a0\n});\nconst _c4 = (a0, a1) => ({\n  x: a0,\n  y: a1\n});\nconst _c5 = (a0, a1) => ({\n  indexAxis: \"y\",\n  plugins: a0,\n  scales: a1\n});\nconst _c6 = a0 => ({\n  \"worse\": a0\n});\nconst _c7 = a0 => ({\n  labels: a0\n});\nconst _c8 = a0 => ({\n  ticks: a0,\n  beginAtZero: true\n});\nconst _c9 = (a0, a1) => ({\n  responsive: true,\n  plugins: a0,\n  scales: a1\n});\nfunction PredictionsComponent_mat_option_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const r_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", r_r2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 2, r_r2));\n  }\n}\nfunction PredictionsComponent_mat_card_63_table_16_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const h_r3 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(h_r3.horizon);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(h_r3.probability));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(h_r3.bucket);\n  }\n}\nfunction PredictionsComponent_mat_card_63_table_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 55)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Horizon\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Bucket\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"tbody\");\n    i0.ɵɵtemplate(10, PredictionsComponent_mat_card_63_table_16_tr_10_Template, 7, 3, \"tr\", 56);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.investorHorizonRows);\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_17_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const row_r5 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.family);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(row_r5.probability));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r5.bucket);\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 57)(1, \"div\", 49);\n    i0.ɵɵtext(2, \"Model families (6m)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\", 58)(4, \"thead\")(5, \"tr\")(6, \"th\");\n    i0.ɵɵtext(7, \"Family\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Bucket\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, PredictionsComponent_mat_card_63_div_17_tr_13_Template, 7, 3, \"tr\", 56);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.investorModelRows);\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_18_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"(\", ctx_r3.investorLocalKn == null ? null : ctx_r3.investorLocalKn.bucket, \")\");\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, PredictionsComponent_mat_card_63_div_18_span_2_Template, 2, 1, \"span\", 46);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" Local k-NN (k=\", (ctx_r3.investorLocalKn == null ? null : ctx_r3.investorLocalKn.k) || 20, \"): \", ctx_r3.formatPercent(ctx_r3.investorLocalKn == null ? null : ctx_r3.investorLocalKn.probability), \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.investorLocalKn == null ? null : ctx_r3.investorLocalKn.bucket);\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_19_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const n_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(n_r6.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(n_r6.label);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(7, 5, n_r6.distance, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(10, 8, n_r6.engagement_score, \"1.0-0\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(n_r6.inactivity_days);\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1, \" Nearest neighbours: \");\n    i0.ɵɵelementStart(2, \"table\", 58)(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Label\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Dist\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Eng\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Inactivity\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(14, PredictionsComponent_mat_card_63_div_19_tr_14_Template, 13, 11, \"tr\", 56);\n    i0.ɵɵpipe(15, \"slice\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(14);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind3(15, 1, ctx_r3.investorNeighbors, 0, 5));\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_20_tr_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const d_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(d_r7.feature);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 4, d_r7.value, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(8, 7, d_r7.portfolio_median, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(11, 10, d_r7.delta_pct * 100, \"1.1-1\"), \"%\");\n  }\n}\nfunction PredictionsComponent_mat_card_63_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1, \" Top drivers vs portfolio median: \");\n    i0.ɵɵelementStart(2, \"table\", 58)(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Feature\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Value\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Median\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"\\u0394%\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(12, PredictionsComponent_mat_card_63_div_20_tr_12_Template, 12, 13, \"tr\", 56);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 59);\n    i0.ɵɵtext(14, \"Contribution (\\u0394% vs median)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"canvas\", 60);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.investorDrivers);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"data\", ctx_r3.investorDriverChart)(\"options\", i0.ɵɵpureFunction2(16, _c5, i0.ɵɵpureFunction1(5, _c1, i0.ɵɵpureFunction0(4, _c0)), i0.ɵɵpureFunction2(13, _c4, i0.ɵɵpureFunction1(8, _c3, i0.ɵɵpureFunction0(7, _c2)), i0.ɵɵpureFunction1(11, _c3, i0.ɵɵpureFunction0(10, _c2)))))(\"type\", \"bar\");\n  }\n}\nfunction PredictionsComponent_mat_card_63_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 47)(1, \"mat-card-subtitle\");\n    i0.ɵɵtext(2, \"Result\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 48)(4, \"div\")(5, \"div\", 49);\n    i0.ɵɵtext(6, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 50);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\")(10, \"div\", 49);\n    i0.ɵɵtext(11, \"Bucket\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 51);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"p\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, PredictionsComponent_mat_card_63_table_16_Template, 11, 1, \"table\", 52)(17, PredictionsComponent_mat_card_63_div_17_Template, 14, 1, \"div\", 53)(18, PredictionsComponent_mat_card_63_div_18_Template, 3, 3, \"div\", 54)(19, PredictionsComponent_mat_card_63_div_19_Template, 16, 5, \"div\", 54)(20, PredictionsComponent_mat_card_63_div_20_Template, 16, 19, \"div\", 54);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(ctx_r3.investorResult == null ? null : ctx_r3.investorResult.churn_probability));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngClass\", ctx_r3.investorResult == null ? null : ctx_r3.investorResult.risk_bucket == null ? null : ctx_r3.investorResult.risk_bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.investorResult == null ? null : ctx_r3.investorResult.risk_bucket);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.investorResult == null ? null : ctx_r3.investorResult.explanation);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.investorHorizonRows.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.investorModelRows.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.investorLocalKn);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.investorNeighbors == null ? null : ctx_r3.investorNeighbors.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.investorDrivers == null ? null : ctx_r3.investorDrivers.length);\n  }\n}\nfunction PredictionsComponent_mat_option_86_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r8);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 2, s_r8));\n  }\n}\nfunction PredictionsComponent_mat_card_114_table_16_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const h_r9 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(h_r9.horizon);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(h_r9.probability));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(h_r9.bucket);\n  }\n}\nfunction PredictionsComponent_mat_card_114_table_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 55)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Horizon\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Bucket\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"tbody\");\n    i0.ɵɵtemplate(10, PredictionsComponent_mat_card_114_table_16_tr_10_Template, 7, 3, \"tr\", 56);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.loanHorizonRows);\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_17_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const row_r10 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r10.family);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(row_r10.probability));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(row_r10.bucket);\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 57)(1, \"div\", 49);\n    i0.ɵɵtext(2, \"Model families (6m)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\", 58)(4, \"thead\")(5, \"tr\")(6, \"th\");\n    i0.ɵɵtext(7, \"Family\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Bucket\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, PredictionsComponent_mat_card_114_div_17_tr_13_Template, 7, 3, \"tr\", 56);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.loanModelRows);\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_18_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"(\", ctx_r3.loanLocalKn == null ? null : ctx_r3.loanLocalKn.bucket, \")\");\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, PredictionsComponent_mat_card_114_div_18_span_2_Template, 2, 1, \"span\", 46);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" Local k-NN (k=\", (ctx_r3.loanLocalKn == null ? null : ctx_r3.loanLocalKn.k) || 20, \"): \", ctx_r3.formatPercent(ctx_r3.loanLocalKn == null ? null : ctx_r3.loanLocalKn.probability), \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.loanLocalKn == null ? null : ctx_r3.loanLocalKn.bucket);\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_19_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\");\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const n_r11 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(n_r11.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(n_r11.label);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(7, 6, n_r11.distance, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(n_r11.sector);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(12, 9, n_r11.ltv_ratio, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 12, n_r11.dscr, \"1.2-2\"));\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1, \" Nearest neighbours: \");\n    i0.ɵɵelementStart(2, \"table\", 58)(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Label\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Dist\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Sector\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"LTV\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \"DSCR\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(16, PredictionsComponent_mat_card_114_div_19_tr_16_Template, 16, 15, \"tr\", 56);\n    i0.ɵɵpipe(17, \"slice\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(16);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind3(17, 1, ctx_r3.loanNeighbors, 0, 5));\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_20_tr_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const d_r12 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(d_r12.feature);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 4, d_r12.value, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(8, 7, d_r12.portfolio_median, \"1.2-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(11, 10, d_r12.delta_pct * 100, \"1.1-1\"), \"%\");\n  }\n}\nfunction PredictionsComponent_mat_card_114_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1, \" Top drivers vs portfolio median: \");\n    i0.ɵɵelementStart(2, \"table\", 58)(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Feature\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Value\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Median\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"\\u0394%\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(12, PredictionsComponent_mat_card_114_div_20_tr_12_Template, 12, 13, \"tr\", 56);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 59);\n    i0.ɵɵtext(14, \"Contribution (\\u0394% vs median)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"canvas\", 60);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.loanDrivers);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"data\", ctx_r3.loanDriverChart)(\"options\", i0.ɵɵpureFunction2(16, _c5, i0.ɵɵpureFunction1(5, _c1, i0.ɵɵpureFunction0(4, _c0)), i0.ɵɵpureFunction2(13, _c4, i0.ɵɵpureFunction1(8, _c3, i0.ɵɵpureFunction0(7, _c2)), i0.ɵɵpureFunction1(11, _c3, i0.ɵɵpureFunction0(10, _c2)))))(\"type\", \"bar\");\n  }\n}\nfunction PredictionsComponent_mat_card_114_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\", 61)(1, \"mat-card-subtitle\");\n    i0.ɵɵtext(2, \"Result\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 48)(4, \"div\")(5, \"div\", 49);\n    i0.ɵɵtext(6, \"Probability\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 50);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\")(10, \"div\", 49);\n    i0.ɵɵtext(11, \"Bucket\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 51);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"p\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, PredictionsComponent_mat_card_114_table_16_Template, 11, 1, \"table\", 52)(17, PredictionsComponent_mat_card_114_div_17_Template, 14, 1, \"div\", 53)(18, PredictionsComponent_mat_card_114_div_18_Template, 3, 3, \"div\", 54)(19, PredictionsComponent_mat_card_114_div_19_Template, 18, 5, \"div\", 54)(20, PredictionsComponent_mat_card_114_div_20_Template, 16, 19, \"div\", 54);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(ctx_r3.loanResult == null ? null : ctx_r3.loanResult.default_probability));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngClass\", ctx_r3.loanResult == null ? null : ctx_r3.loanResult.risk_bucket == null ? null : ctx_r3.loanResult.risk_bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.loanResult == null ? null : ctx_r3.loanResult.risk_bucket);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.loanResult == null ? null : ctx_r3.loanResult.explanation);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.loanHorizonRows.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.loanModelRows.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.loanLocalKn);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.loanNeighbors == null ? null : ctx_r3.loanNeighbors.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.loanDrivers == null ? null : ctx_r3.loanDrivers.length);\n  }\n}\nfunction PredictionsComponent_div_119_mat_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const inv_r14 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", inv_r14.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", inv_r14.name || \"Investor \" + inv_r14.id, \" \\u2013 \", i0.ɵɵpipeBind1(2, 4, inv_r14.risk_tolerance), \", AUM \", i0.ɵɵpipeBind2(3, 6, inv_r14.aum, \"1.0-0\"), \" \");\n  }\n}\nfunction PredictionsComponent_div_119_mat_option_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const h_r15 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", h_r15);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(h_r15);\n  }\n}\nfunction PredictionsComponent_div_119_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 66)(1, \"div\", 67)(2, \"div\", 5);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 50);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 51);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 67)(9, \"div\", 5);\n    i0.ɵɵtext(10, \"Scenario\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 50);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 51);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 68);\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Base \", ctx_r3.scenarioInvestorResult.horizon, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(ctx_r3.scenarioInvestorResult.base == null ? null : ctx_r3.scenarioInvestorResult.base.probability));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", ctx_r3.scenarioInvestorResult.base == null ? null : ctx_r3.scenarioInvestorResult.base.bucket == null ? null : ctx_r3.scenarioInvestorResult.base.bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.scenarioInvestorResult.base == null ? null : ctx_r3.scenarioInvestorResult.base.bucket);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(ctx_r3.scenarioInvestorResult.scenario == null ? null : ctx_r3.scenarioInvestorResult.scenario.probability));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", ctx_r3.scenarioInvestorResult.scenario == null ? null : ctx_r3.scenarioInvestorResult.scenario.bucket == null ? null : ctx_r3.scenarioInvestorResult.scenario.bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.scenarioInvestorResult.scenario == null ? null : ctx_r3.scenarioInvestorResult.scenario.bucket);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(9, _c6, ((ctx_r3.scenarioInvestorResult.scenario == null ? null : ctx_r3.scenarioInvestorResult.scenario.probability) || 0) > ((ctx_r3.scenarioInvestorResult.base == null ? null : ctx_r3.scenarioInvestorResult.base.probability) || 0)));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \\u0394 \", ctx_r3.deltaLabel(ctx_r3.scenarioInvestorResult.base == null ? null : ctx_r3.scenarioInvestorResult.base.probability, ctx_r3.scenarioInvestorResult.scenario == null ? null : ctx_r3.scenarioInvestorResult.scenario.probability), \" \");\n  }\n}\nfunction PredictionsComponent_div_119_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 8);\n    i0.ɵɵlistener(\"ngSubmit\", function PredictionsComponent_div_119_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.runInvestorScenario());\n    });\n    i0.ɵɵelementStart(2, \"div\", 9)(3, \"mat-form-field\", 10)(4, \"mat-label\");\n    i0.ɵɵtext(5, \"Select investor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-select\", 62);\n    i0.ɵɵlistener(\"selectionChange\", function PredictionsComponent_div_119_Template_mat_select_selectionChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onInvestorSelect($event.value));\n    });\n    i0.ɵɵtemplate(7, PredictionsComponent_div_119_mat_option_7_Template, 4, 9, \"mat-option\", 14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"mat-form-field\", 10)(9, \"mat-label\");\n    i0.ɵɵtext(10, \"Horizon\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"mat-select\", 63);\n    i0.ɵɵtemplate(12, PredictionsComponent_div_119_mat_option_12_Template, 2, 2, \"mat-option\", 14);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"div\", 9)(14, \"mat-form-field\", 10)(15, \"mat-label\");\n    i0.ɵɵtext(16, \"Engagement score\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(17, \"input\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"mat-form-field\", 10)(19, \"mat-label\");\n    i0.ɵɵtext(20, \"Inactivity days\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(21, \"input\", 18);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"mat-form-field\", 10)(23, \"mat-label\");\n    i0.ɵɵtext(24, \"Call frequency (per quarter)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(25, \"input\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"button\", 64);\n    i0.ɵɵtext(27, \"Run scenario\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(28, PredictionsComponent_div_119_div_28_Template, 17, 11, \"div\", 65);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r3.investorScenarioForm);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.sampleInvestors);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.scenarioHorizonOptions);\n    i0.ɵɵadvance(16);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.scenarioInvestorResult);\n  }\n}\nfunction PredictionsComponent_ng_template_120_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5);\n    i0.ɵɵtext(1, \"Loading synthetic investors...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PredictionsComponent_div_125_mat_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loan_r17 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", loan_r17.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" Loan #\", loan_r17.id, \" \\u2013 \", i0.ɵɵpipeBind1(2, 4, loan_r17.sector), \" \\u2013 $\", i0.ɵɵpipeBind2(3, 6, loan_r17.amount, \"1.0-0\"), \" \");\n  }\n}\nfunction PredictionsComponent_div_125_mat_option_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const h_r18 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", h_r18);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(h_r18);\n  }\n}\nfunction PredictionsComponent_div_125_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 66)(1, \"div\", 67)(2, \"div\", 5);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 50);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 51);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 67)(9, \"div\", 5);\n    i0.ɵɵtext(10, \"Scenario\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 50);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 51);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 68);\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Base \", ctx_r3.scenarioLoanResult.horizon, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(ctx_r3.scenarioLoanResult.base == null ? null : ctx_r3.scenarioLoanResult.base.probability));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", ctx_r3.scenarioLoanResult.base == null ? null : ctx_r3.scenarioLoanResult.base.bucket == null ? null : ctx_r3.scenarioLoanResult.base.bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.scenarioLoanResult.base == null ? null : ctx_r3.scenarioLoanResult.base.bucket);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r3.formatPercent(ctx_r3.scenarioLoanResult.scenario == null ? null : ctx_r3.scenarioLoanResult.scenario.probability));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", ctx_r3.scenarioLoanResult.scenario == null ? null : ctx_r3.scenarioLoanResult.scenario.bucket == null ? null : ctx_r3.scenarioLoanResult.scenario.bucket.toLowerCase());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.scenarioLoanResult.scenario == null ? null : ctx_r3.scenarioLoanResult.scenario.bucket);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(9, _c6, ((ctx_r3.scenarioLoanResult.scenario == null ? null : ctx_r3.scenarioLoanResult.scenario.probability) || 0) > ((ctx_r3.scenarioLoanResult.base == null ? null : ctx_r3.scenarioLoanResult.base.probability) || 0)));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \\u0394 \", ctx_r3.deltaLabel(ctx_r3.scenarioLoanResult.base == null ? null : ctx_r3.scenarioLoanResult.base.probability, ctx_r3.scenarioLoanResult.scenario == null ? null : ctx_r3.scenarioLoanResult.scenario.probability), \" \");\n  }\n}\nfunction PredictionsComponent_div_125_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 8);\n    i0.ɵɵlistener(\"ngSubmit\", function PredictionsComponent_div_125_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.runLoanScenario());\n    });\n    i0.ɵɵelementStart(2, \"div\", 9)(3, \"mat-form-field\", 10)(4, \"mat-label\");\n    i0.ɵɵtext(5, \"Select loan\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-select\", 62);\n    i0.ɵɵlistener(\"selectionChange\", function PredictionsComponent_div_125_Template_mat_select_selectionChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onLoanSelect($event.value));\n    });\n    i0.ɵɵtemplate(7, PredictionsComponent_div_125_mat_option_7_Template, 4, 9, \"mat-option\", 14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"mat-form-field\", 10)(9, \"mat-label\");\n    i0.ɵɵtext(10, \"Horizon\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"mat-select\", 63);\n    i0.ɵɵtemplate(12, PredictionsComponent_div_125_mat_option_12_Template, 2, 2, \"mat-option\", 14);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"div\", 9)(14, \"mat-form-field\", 10)(15, \"mat-label\");\n    i0.ɵɵtext(16, \"LTV ratio\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(17, \"input\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"mat-form-field\", 10)(19, \"mat-label\");\n    i0.ɵɵtext(20, \"DSCR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(21, \"input\", 30);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"mat-form-field\", 10)(23, \"mat-label\");\n    i0.ɵɵtext(24, \"Term (months)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(25, \"input\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"button\", 64);\n    i0.ɵɵtext(27, \"Run scenario\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(28, PredictionsComponent_div_125_div_28_Template, 17, 11, \"div\", 65);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r3.loanScenarioForm);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.sampleLoans);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.scenarioHorizonOptions);\n    i0.ɵɵadvance(16);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.scenarioLoanResult);\n  }\n}\nfunction PredictionsComponent_ng_template_126_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5);\n    i0.ɵɵtext(1, \"Loading synthetic loans...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PredictionsComponent_mat_option_137_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r19 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", p_r19);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 2, p_r19));\n  }\n}\nfunction PredictionsComponent_mat_option_142_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const h_r20 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", h_r20);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(h_r20);\n  }\n}\nfunction PredictionsComponent_mat_option_147_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const f_r21 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", f_r21);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 2, f_r21));\n  }\n}\nfunction PredictionsComponent_div_148_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 72)(1, \"div\")(2, \"span\", 49);\n    i0.ɵɵtext(3, \"Threshold\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\")(7, \"span\", 49);\n    i0.ɵɵtext(8, \"Precision\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\")(11, \"span\", 49);\n    i0.ɵɵtext(12, \"Recall\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\")(15, \"span\", 49);\n    i0.ɵɵtext(16, \"TPR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\")(19, \"span\", 49);\n    i0.ɵɵtext(20, \"FPR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"div\")(23, \"span\", 49);\n    i0.ɵɵtext(24, \"Triggered\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(5, 6, ctx_r3.selectedThreshold, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.formatPercent(ctx_r3.thresholdSummary == null ? null : ctx_r3.thresholdSummary.precision), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.formatPercent(ctx_r3.thresholdSummary == null ? null : ctx_r3.thresholdSummary.recall), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.formatPercent(ctx_r3.thresholdSummary == null ? null : ctx_r3.thresholdSummary.tpr), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.formatPercent(ctx_r3.thresholdSummary == null ? null : ctx_r3.thresholdSummary.fpr), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.formatPercent(ctx_r3.thresholdSummary == null ? null : ctx_r3.thresholdSummary.positive_rate), \"\");\n  }\n}\nfunction PredictionsComponent_div_148_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 69)(1, \"mat-slider\", 70);\n    i0.ɵɵlistener(\"input\", function PredictionsComponent_div_148_Template_mat_slider_input_1_listener($event) {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onThresholdChange($event.value));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(2, PredictionsComponent_div_148_div_2_Template, 26, 9, \"div\", 71);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"displayWith\", ctx_r3.formatPercent)(\"value\", ctx_r3.selectedThreshold);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.thresholdSummary);\n  }\n}\nfunction PredictionsComponent_ng_template_149_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5);\n    i0.ɵɵtext(1, \"No threshold grid available for this selection.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PredictionsComponent_div_151_mat_card_17_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵpipe(4, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" Churn AUC: \", i0.ɵɵpipeBind2(2, 3, ctx_r3.baselineCI.churn.auc.mean, \"1.2-2\"), \" [\", i0.ɵɵpipeBind2(3, 6, ctx_r3.baselineCI.churn.auc.ci[0], \"1.2-2\"), \" \\u2013 \", i0.ɵɵpipeBind2(4, 9, ctx_r3.baselineCI.churn.auc.ci[1], \"1.2-2\"), \"] \");\n  }\n}\nfunction PredictionsComponent_div_151_mat_card_17_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 59);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵpipe(4, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" Default AUC: \", i0.ɵɵpipeBind2(2, 3, ctx_r3.baselineCI.default.auc.mean, \"1.2-2\"), \" [\", i0.ɵɵpipeBind2(3, 6, ctx_r3.baselineCI.default.auc.ci[0], \"1.2-2\"), \" \\u2013 \", i0.ɵɵpipeBind2(4, 9, ctx_r3.baselineCI.default.auc.ci[1], \"1.2-2\"), \"] \");\n  }\n}\nfunction PredictionsComponent_div_151_mat_card_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\")(1, \"mat-card-title\");\n    i0.ɵɵtext(2, \"Uncertainty (bootstrap CI)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, PredictionsComponent_div_151_mat_card_17_div_3_Template, 5, 12, \"div\", 54)(4, PredictionsComponent_div_151_mat_card_17_div_4_Template, 5, 12, \"div\", 54);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.baselineCI.churn == null ? null : ctx_r3.baselineCI.churn.auc);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.baselineCI.default == null ? null : ctx_r3.baselineCI.default.auc);\n  }\n}\nfunction PredictionsComponent_div_151_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 73)(1, \"mat-card\")(2, \"mat-card-title\");\n    i0.ɵɵtext(3, \"Churn Feature Importance\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"canvas\", 60);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-card\")(6, \"mat-card-title\");\n    i0.ɵɵtext(7, \"Default Feature Importance\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"canvas\", 60);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"mat-card\")(10, \"mat-card-title\");\n    i0.ɵɵtext(11, \"Churn Calibration\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"canvas\", 60);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"mat-card\")(14, \"mat-card-title\");\n    i0.ɵɵtext(15, \"Default Calibration\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"canvas\", 60);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(17, PredictionsComponent_div_151_mat_card_17_Template, 5, 2, \"mat-card\", 46);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"data\", ctx_r3.churnImportanceData)(\"options\", ctx_r3.chartOptions)(\"type\", \"bar\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"data\", ctx_r3.defaultImportanceData)(\"options\", ctx_r3.chartOptions)(\"type\", \"bar\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"data\", ctx_r3.churnCalibrationData)(\"options\", i0.ɵɵpureFunction2(27, _c9, i0.ɵɵpureFunction1(16, _c1, i0.ɵɵpureFunction1(14, _c7, i0.ɵɵpureFunction0(13, _c2))), i0.ɵɵpureFunction2(24, _c4, i0.ɵɵpureFunction1(19, _c3, i0.ɵɵpureFunction0(18, _c2)), i0.ɵɵpureFunction1(22, _c8, i0.ɵɵpureFunction0(21, _c2)))))(\"type\", \"line\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"data\", ctx_r3.defaultCalibrationData)(\"options\", i0.ɵɵpureFunction2(44, _c9, i0.ɵɵpureFunction1(33, _c1, i0.ɵɵpureFunction1(31, _c7, i0.ɵɵpureFunction0(30, _c2))), i0.ɵɵpureFunction2(41, _c4, i0.ɵɵpureFunction1(36, _c3, i0.ɵɵpureFunction0(35, _c2)), i0.ɵɵpureFunction1(39, _c8, i0.ɵɵpureFunction0(38, _c2)))))(\"type\", \"line\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.baselineCI);\n  }\n}\nfunction PredictionsComponent_div_158_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 78);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.aiAnswer, \" \");\n  }\n}\nfunction PredictionsComponent_div_158_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"mat-form-field\", 74)(2, \"mat-label\");\n    i0.ɵɵtext(3, \"Ask about these predictions\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"textarea\", 75);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function PredictionsComponent_div_158_Template_textarea_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r3 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r3.aiQuestion, $event) || (ctx_r3.aiQuestion = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"button\", 76);\n    i0.ɵɵlistener(\"click\", function PredictionsComponent_div_158_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.askAi());\n    });\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, PredictionsComponent_div_158_div_7_Template, 2, 1, \"div\", 77);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r3.aiQuestion);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r3.aiLoading || !ctx_r3.aiQuestion);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.aiLoading ? \"Thinking...\" : \"Ask AI\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.aiAnswer);\n  }\n}\nexport let PredictionsComponent = /*#__PURE__*/(() => {\n  class PredictionsComponent {\n    constructor(fb, api, snackBar) {\n      this.fb = fb;\n      this.api = api;\n      this.snackBar = snackBar;\n      this.riskOptions = [\"low\", \"medium\", \"high\"];\n      this.sectorOptions = [\"property\", \"infrastructure\", \"healthcare\", \"technology\", \"hospitality\"];\n      this.investorHorizonRows = [];\n      this.loanHorizonRows = [];\n      this.investorModelRows = [];\n      this.loanModelRows = [];\n      this.investorNeighbors = [];\n      this.loanNeighbors = [];\n      this.investorDrivers = [];\n      this.loanDrivers = [];\n      this.scenarioHorizonOptions = [\"3m\", \"6m\", \"12m\"];\n      this.sampleInvestors = [];\n      this.sampleLoans = [];\n      this.loadingInvestor = false;\n      this.loadingLoan = false;\n      this.churnImportanceData = {\n        labels: [],\n        datasets: [{\n          data: [],\n          backgroundColor: \"#0ea5e9\"\n        }]\n      };\n      this.defaultImportanceData = {\n        labels: [],\n        datasets: [{\n          data: [],\n          backgroundColor: \"#f59e0b\"\n        }]\n      };\n      this.churnCalibrationData = {\n        labels: [],\n        datasets: []\n      };\n      this.defaultCalibrationData = {\n        labels: [],\n        datasets: []\n      };\n      this.investorDriverChart = {\n        labels: [],\n        datasets: []\n      };\n      this.loanDriverChart = {\n        labels: [],\n        datasets: []\n      };\n      this.chartOptions = {\n        responsive: true,\n        plugins: {\n          legend: {\n            display: false\n          }\n        },\n        scales: {\n          x: {\n            ticks: {\n              color: \"#9bb0c9\"\n            }\n          },\n          y: {\n            ticks: {\n              color: \"#9bb0c9\"\n            },\n            beginAtZero: true\n          }\n        }\n      };\n      this.thresholdGrid = [];\n      this.selectedThreshold = 0.5;\n      this.thresholdMeta = {\n        problem: \"churn\",\n        horizon: \"6m\",\n        family: \"ensemble\"\n      };\n      this.thresholdFamilies = [\"ensemble\", \"adaboost\", \"logistic\"];\n      this.thresholdProblems = [\"churn\", \"default\"];\n      this.thresholdHorizons = [\"3m\", \"6m\", \"12m\"];\n      this.modelMetricsAll = {};\n      this.compareConfig = {\n        problem: \"churn\",\n        horizon: \"6m\",\n        family: \"ensemble\"\n      };\n      this.compareFamilies = [];\n      this.aiQuestion = \"\";\n      this.aiAnswer = \"\";\n      this.aiLoading = false;\n      this.aiHistory = [];\n      this.aiOpen = true;\n      this.whatIfChurn = 60;\n      this.whatIfDefault = 0.6;\n      this.whatIfCurves = {};\n      this.investorForm = this.fb.nonNullable.group({\n        age: [45, [Validators.required]],\n        aum: [1500000, [Validators.required]],\n        risk_tolerance: [\"medium\", Validators.required],\n        engagement_score: [60, [Validators.required]],\n        email_open_rate: [0.5, [Validators.required]],\n        call_frequency: [4, [Validators.required]],\n        inactivity_days: [30, [Validators.required]],\n        redemption_intent: [false, [Validators.required]],\n        distribution_yield: [0.07, [Validators.required]],\n        meetings_last_quarter: [2, [Validators.required]]\n      });\n      this.investorScenarioForm = this.fb.nonNullable.group({\n        entity_id: [0, [Validators.required]],\n        horizon: [\"6m\", [Validators.required]],\n        engagement_score: [60, [Validators.required]],\n        inactivity_days: [30, [Validators.required]],\n        call_frequency: [4, [Validators.required]]\n      });\n      this.loanForm = this.fb.nonNullable.group({\n        amount: [750000, [Validators.required]],\n        ltv_ratio: [0.6, [Validators.required]],\n        term_months: [36, [Validators.required]],\n        sector: [\"property\", Validators.required],\n        arrears_flag: [false, Validators.required],\n        dscr: [1.2, [Validators.required]],\n        covenants_flag: [false, Validators.required],\n        collateral_score: [0.7, [Validators.required]]\n      });\n      this.loanScenarioForm = this.fb.nonNullable.group({\n        entity_id: [0, [Validators.required]],\n        horizon: [\"6m\", [Validators.required]],\n        ltv_ratio: [0.6, [Validators.required]],\n        dscr: [1.2, [Validators.required]],\n        term_months: [36, [Validators.required]]\n      });\n    }\n    ngOnInit() {\n      this.loadMetrics();\n      this.loadAllModelMetrics();\n      this.loadSamples();\n      this.loadThresholds();\n    }\n    submitInvestor() {\n      if (this.investorForm.invalid) {\n        this.investorForm.markAllAsTouched();\n        return;\n      }\n      this.loadingInvestor = true;\n      const payload = {\n        ...this.investorForm.value\n      };\n      payload.age = Number(payload.age);\n      payload.aum = Number(payload.aum);\n      payload.engagement_score = Number(payload.engagement_score);\n      payload.email_open_rate = Number(payload.email_open_rate);\n      payload.call_frequency = Number(payload.call_frequency);\n      this.api.predictInvestorChurn(payload).subscribe({\n        next: res => {\n          this.investorResult = res;\n          this.investorHorizonRows = this.mapHorizons(res.horizons);\n          this.investorModelRows = this.toModelRows(res.models, \"6m\");\n          this.investorLocalKn = res.local_knn?.[\"6m\"] || undefined;\n          this.investorNeighbors = res.neighbors || [];\n          this.investorDrivers = res.drivers || [];\n          this.investorDriverChart = this.toDriverChart(this.investorDrivers, \"Churn drivers\");\n          this.loadingInvestor = false;\n        },\n        error: err => this.handleError(\"Unable to predict churn\", err, \"investor\")\n      });\n    }\n    submitLoan() {\n      if (this.loanForm.invalid) {\n        this.loanForm.markAllAsTouched();\n        return;\n      }\n      this.loadingLoan = true;\n      const payload = {\n        ...this.loanForm.value\n      };\n      payload.amount = Number(payload.amount);\n      payload.ltv_ratio = Number(payload.ltv_ratio);\n      payload.term_months = Number(payload.term_months);\n      payload.arrears_flag = !!payload.arrears_flag;\n      this.api.predictLoanDefault(payload).subscribe({\n        next: res => {\n          this.loanResult = res;\n          this.loanHorizonRows = this.mapHorizons(res.horizons);\n          this.loanModelRows = this.toModelRows(res.models, \"6m\");\n          this.loanLocalKn = res.local_knn?.[\"6m\"] || undefined;\n          this.loanNeighbors = res.neighbors || [];\n          this.loanDrivers = res.drivers || [];\n          this.loanDriverChart = this.toDriverChart(this.loanDrivers, \"Default drivers\");\n          this.loadingLoan = false;\n        },\n        error: err => this.handleError(\"Unable to predict default risk\", err, \"loan\")\n      });\n    }\n    formatPercent(prob) {\n      if (prob === undefined || prob === null) return \"0.0%\";\n      return `${(prob * 100).toFixed(1)}%`;\n    }\n    handleError(message, err, type) {\n      console.error(message, err);\n      if (type === \"investor\") this.loadingInvestor = false;\n      if (type === \"loan\") this.loadingLoan = false;\n      this.snackBar.open(message, \"Close\", {\n        duration: 3000\n      });\n    }\n    loadMetrics() {\n      this.api.getModelMetrics().subscribe({\n        next: m => {\n          this.metrics = m;\n          this.baselineCI = m?.bootstrap_ci;\n          this.churnImportanceData = this.toBarData(m?.churn?.feature_importance, \"#0ea5e9\");\n          this.defaultImportanceData = this.toBarData(m?.default?.feature_importance, \"#f59e0b\");\n          this.churnCalibrationData = this.toCalibrationData(m?.churn?.calibration, \"Churn\");\n          this.defaultCalibrationData = this.toCalibrationData(m?.default?.calibration, \"Default\");\n        },\n        error: () => {}\n      });\n    }\n    loadAllModelMetrics() {\n      this.api.getAllModelMetrics().subscribe({\n        next: resp => {\n          this.modelMetricsAll = resp || {};\n          this.updateCompareFamilies();\n          this.whatIfCurves = this.buildWhatIfCurves();\n        },\n        error: err => console.warn(\"Unable to load model metrics\", err)\n      });\n    }\n    get compareMetrics() {\n      const problemBlock = this.modelMetricsAll?.[this.compareConfig.problem];\n      if (!problemBlock) return null;\n      const familyBlock = problemBlock?.[this.compareConfig.family] || problemBlock;\n      const horizonBlock = familyBlock?.[this.compareConfig.horizon] || familyBlock;\n      return horizonBlock || null;\n    }\n    updateCompareFamilies() {\n      const problemBlock = this.modelMetricsAll?.[this.compareConfig.problem] || {};\n      const keys = Object.keys(problemBlock || {}).filter(k => typeof problemBlock[k] === \"object\");\n      this.compareFamilies = keys.length ? keys : [\"ensemble\"];\n      if (!this.compareFamilies.includes(this.compareConfig.family)) {\n        this.compareConfig.family = this.compareFamilies[0];\n      }\n    }\n    onCompareProblemChange() {\n      this.updateCompareFamilies();\n    }\n    loadThresholds(problem = \"churn\", horizon = \"6m\", family = \"ensemble\") {\n      this.thresholdMeta = {\n        problem,\n        horizon,\n        family\n      };\n      this.api.getModelThresholds(problem, horizon, family).subscribe({\n        next: resp => {\n          this.thresholdGrid = resp?.thresholds || [];\n          this.selectedThreshold = 0.5;\n          this.updateThresholdSummary();\n        },\n        error: err => console.warn(\"Unable to load thresholds\", err)\n      });\n    }\n    toBarData(imp, color) {\n      if (!imp) return {\n        labels: [],\n        datasets: []\n      };\n      const entries = Object.entries(imp);\n      return {\n        labels: entries.map(e => e[0]),\n        datasets: [{\n          data: entries.map(e => e[1]),\n          backgroundColor: color\n        }]\n      };\n    }\n    toCalibrationData(cal, label) {\n      if (!cal?.fraction_positives || !cal?.mean_predictions) return {\n        labels: [],\n        datasets: []\n      };\n      return {\n        labels: cal.mean_predictions.map((_, idx) => `Bin ${idx + 1}`),\n        datasets: [{\n          label,\n          data: cal.fraction_positives,\n          borderColor: \"#19c3b1\",\n          backgroundColor: \"rgba(25,195,177,0.2)\",\n          tension: 0.25,\n          fill: true\n        }]\n      };\n    }\n    toDriverChart(drivers, label) {\n      if (!drivers?.length) return {\n        labels: [],\n        datasets: []\n      };\n      const labels = drivers.map(d => d.feature);\n      const deltas = drivers.map(d => (d.delta_pct || 0) * 100);\n      const colors = deltas.map(d => d >= 0 ? \"rgba(239,68,68,0.5)\" : \"rgba(34,197,94,0.5)\");\n      return {\n        labels,\n        datasets: [{\n          label,\n          data: deltas,\n          backgroundColor: colors,\n          borderColor: colors.map(c => c.replace(\"0.5\", \"1\")),\n          borderWidth: 1\n        }]\n      };\n    }\n    buildWhatIfCurves() {\n      const nl = this.modelMetricsAll?.non_linear || {};\n      const make = (series, label, color, pointX) => {\n        if (!series?.x || !series?.y) return undefined;\n        const pointY = this.interpolate(series.x, series.y, pointX);\n        return {\n          labels: series.x,\n          datasets: [{\n            data: series.y,\n            label,\n            borderColor: color,\n            backgroundColor: \"rgba(0,0,0,0)\",\n            tension: 0.15,\n            fill: false\n          }, {\n            data: [{\n              x: pointX,\n              y: pointY\n            }],\n            label: \"Scenario\",\n            pointRadius: 6,\n            showLine: false,\n            borderColor: \"#f59e0b\",\n            backgroundColor: \"#f59e0b\"\n          }]\n        };\n      };\n      return {\n        churn: make(nl.churn?.engagement_score, \"Churn vs engagement\", \"#22c55e\", this.whatIfChurn),\n        default: make(nl.default?.ltv_ratio, \"Default vs LTV\", \"#ef4444\", this.whatIfDefault)\n      };\n    }\n    interpolate(xs, ys, x) {\n      if (!xs?.length || !ys?.length) return 0;\n      for (let i = 0; i < xs.length - 1; i++) {\n        const x1 = xs[i];\n        const x2 = xs[i + 1];\n        if (x >= x1 && x <= x2) {\n          const y1 = ys[i];\n          const y2 = ys[i + 1];\n          const t = (x - x1) / (x2 - x1 || 1);\n          return y1 + t * (y2 - y1);\n        }\n      }\n      return ys[ys.length - 1];\n    }\n    askAi() {\n      if (!this.aiQuestion) return;\n      this.aiLoading = true;\n      this.aiHistory.push({\n        role: \"user\",\n        content: this.aiQuestion\n      });\n      const context = {\n        investorResult: this.investorResult,\n        loanResult: this.loanResult,\n        investorForm: this.investorForm.value,\n        loanForm: this.loanForm.value,\n        metrics: this.metrics\n      };\n      this.api.askAi(this.aiQuestion, \"predictions\", context, this.aiHistory).subscribe({\n        next: resp => {\n          this.aiAnswer = resp.answer;\n          this.aiHistory.push({\n            role: \"assistant\",\n            content: resp.answer\n          });\n          this.aiLoading = false;\n          this.aiQuestion = \"\";\n        },\n        error: err => this.handleError(\"AI explanation failed\", err, \"investor\")\n      });\n    }\n    loadSamples() {\n      this.api.getAnalyticsSamples(50).subscribe({\n        next: resp => {\n          this.sampleInvestors = resp.investors || [];\n          this.sampleLoans = resp.loans || [];\n          if (this.sampleInvestors.length) {\n            this.investorScenarioForm.patchValue({\n              entity_id: this.sampleInvestors[0].id,\n              engagement_score: this.sampleInvestors[0].engagement_score ?? 60,\n              inactivity_days: this.sampleInvestors[0].inactivity_days ?? 30,\n              call_frequency: this.sampleInvestors[0].call_frequency ?? 4\n            });\n          }\n          if (this.sampleLoans.length) {\n            this.loanScenarioForm.patchValue({\n              entity_id: this.sampleLoans[0].id,\n              ltv_ratio: this.sampleLoans[0].ltv_ratio ?? 0.6,\n              dscr: this.sampleLoans[0].dscr ?? 1.2,\n              term_months: this.sampleLoans[0].term_months ?? 36\n            });\n          }\n        },\n        error: err => console.warn(\"Unable to load samples\", err)\n      });\n    }\n    onInvestorSelect(id) {\n      const found = this.sampleInvestors.find(i => i.id === Number(id));\n      if (found) {\n        this.investorScenarioForm.patchValue({\n          engagement_score: found.engagement_score ?? 60,\n          inactivity_days: found.inactivity_days ?? 30,\n          call_frequency: found.call_frequency ?? 4\n        });\n      }\n    }\n    onLoanSelect(id) {\n      const found = this.sampleLoans.find(l => l.id === Number(id));\n      if (found) {\n        this.loanScenarioForm.patchValue({\n          ltv_ratio: found.ltv_ratio ?? 0.6,\n          dscr: found.dscr ?? 1.2,\n          term_months: found.term_months ?? 36\n        });\n      }\n    }\n    runInvestorScenario() {\n      if (this.investorScenarioForm.invalid) {\n        this.investorScenarioForm.markAllAsTouched();\n        return;\n      }\n      const payload = this.investorScenarioForm.getRawValue();\n      this.api.runScenarioPredict({\n        entity_type: \"investor\",\n        entity_id: Number(payload.entity_id),\n        horizon: payload.horizon,\n        overrides: {\n          engagement_score: Number(payload.engagement_score),\n          inactivity_days: Number(payload.inactivity_days),\n          call_frequency: Number(payload.call_frequency)\n        }\n      }).subscribe({\n        next: res => this.scenarioInvestorResult = res,\n        error: err => this.handleError(\"Scenario run failed\", err, \"investor\")\n      });\n    }\n    runLoanScenario() {\n      if (this.loanScenarioForm.invalid) {\n        this.loanScenarioForm.markAllAsTouched();\n        return;\n      }\n      const payload = this.loanScenarioForm.getRawValue();\n      this.api.runScenarioPredict({\n        entity_type: \"loan\",\n        entity_id: Number(payload.entity_id),\n        horizon: payload.horizon,\n        overrides: {\n          ltv_ratio: Number(payload.ltv_ratio),\n          dscr: Number(payload.dscr),\n          term_months: Number(payload.term_months)\n        }\n      }).subscribe({\n        next: res => this.scenarioLoanResult = res,\n        error: err => this.handleError(\"Scenario run failed\", err, \"loan\")\n      });\n    }\n    deltaLabel(base, scenario) {\n      if (base === undefined || scenario === undefined) return \"0.0%\";\n      const delta = (scenario - base) * 100;\n      const sign = delta > 0 ? \"+\" : \"\";\n      return `${sign}${delta.toFixed(1)}%`;\n    }\n    mapHorizons(h) {\n      if (!h) return [];\n      return Object.entries(h).map(([key, val]) => ({\n        horizon: key,\n        probability: val.probability,\n        bucket: val.bucket\n      }));\n    }\n    toModelRows(models, horizon) {\n      if (!models) return [];\n      const rows = [];\n      Object.entries(models).forEach(([family, horizons]) => {\n        const entry = horizons[horizon] || Object.values(horizons || {})[0];\n        if (entry) {\n          rows.push({\n            family,\n            probability: entry.probability,\n            bucket: entry.bucket\n          });\n        }\n      });\n      return rows.sort((a, b) => a.family.localeCompare(b.family));\n    }\n    updateThresholdSummary() {\n      if (!this.thresholdGrid?.length) {\n        this.thresholdSummary = undefined;\n        return;\n      }\n      const closest = this.thresholdGrid.reduce((prev, curr) => Math.abs(curr.threshold - this.selectedThreshold) < Math.abs((prev?.threshold ?? 0) - this.selectedThreshold) ? curr : prev);\n      this.thresholdSummary = closest;\n    }\n    onThresholdChange(val) {\n      if (val === null || val === undefined) return;\n      this.selectedThreshold = val;\n      this.updateThresholdSummary();\n    }\n    onThresholdMetaChange() {\n      this.loadThresholds(this.thresholdMeta.problem, this.thresholdMeta.horizon, this.thresholdMeta.family);\n    }\n    onWhatIfChurnChange(val) {\n      this.whatIfChurn = val;\n      this.whatIfCurves = this.buildWhatIfCurves();\n    }\n    onWhatIfDefaultChange(val) {\n      this.whatIfDefault = val;\n      this.whatIfCurves = this.buildWhatIfCurves();\n    }\n    static {\n      this.ɵfac = function PredictionsComponent_Factory(t) {\n        return new (t || PredictionsComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: PredictionsComponent,\n        selectors: [[\"app-predictions\"]],\n        decls: 159,\n        vars: 31,\n        consts: [[\"noInvestorSamples\", \"\"], [\"noLoanSamples\", \"\"], [\"noThresholds\", \"\"], [1, \"header\"], [1, \"page-title\"], [1, \"muted\"], [1, \"grid\"], [1, \"form-card\"], [3, \"ngSubmit\", \"formGroup\"], [1, \"two-col\"], [\"appearance\", \"fill\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"age\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"aum\"], [\"formControlName\", \"risk_tolerance\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"engagement_score\"], [\"matInput\", \"\", \"type\", \"number\", \"step\", \"0.01\", \"formControlName\", \"email_open_rate\"], [\"matInput\", \"\", \"type\", \"number\", \"step\", \"0.1\", \"formControlName\", \"call_frequency\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"inactivity_days\"], [\"matInput\", \"\", \"type\", \"number\", \"step\", \"0.001\", \"formControlName\", \"distribution_yield\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"meetings_last_quarter\"], [\"formControlName\", \"redemption_intent\"], [3, \"value\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"disabled\"], [\"class\", \"result-card\", \"color\", \"accent\", 4, \"ngIf\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"amount\"], [\"matInput\", \"\", \"type\", \"number\", \"step\", \"0.01\", \"formControlName\", \"ltv_ratio\"], [\"matInput\", \"\", \"type\", \"number\", \"formControlName\", \"term_months\"], [\"formControlName\", \"sector\"], [\"formControlName\", \"arrears_flag\"], [\"matInput\", \"\", \"type\", \"number\", \"step\", \"0.01\", \"formControlName\", \"dscr\"], [\"matInput\", \"\", \"type\", \"number\", \"step\", \"0.01\", \"formControlName\", \"collateral_score\"], [\"formControlName\", \"covenants_flag\"], [\"class\", \"result-card\", 4, \"ngIf\"], [1, \"scenario-grid\"], [1, \"form-card\", \"scenario-card\"], [4, \"ngIf\", \"ngIfElse\"], [1, \"form-card\", \"threshold-card\"], [1, \"threshold-header\"], [1, \"threshold-selects\"], [3, \"ngModelChange\", \"selectionChange\", \"ngModel\"], [\"class\", \"slider-row\", 4, \"ngIf\", \"ngIfElse\"], [\"class\", \"metrics-grid\", 4, \"ngIf\"], [1, \"ai-card\"], [1, \"ai-header\"], [\"mat-stroked-button\", \"\", \"color\", \"accent\", 3, \"click\"], [4, \"ngIf\"], [\"color\", \"accent\", 1, \"result-card\"], [1, \"result-row\"], [1, \"label\"], [1, \"value\"], [1, \"chip\", 3, \"ngClass\"], [\"class\", \"horizon-table\", 4, \"ngIf\"], [\"class\", \"model-compare\", 4, \"ngIf\"], [\"class\", \"muted small\", 4, \"ngIf\"], [1, \"horizon-table\"], [4, \"ngFor\", \"ngForOf\"], [1, \"model-compare\"], [1, \"horizon-table\", \"compact\"], [1, \"muted\", \"small\"], [\"baseChart\", \"\", 3, \"data\", \"options\", \"type\"], [1, \"result-card\"], [\"formControlName\", \"entity_id\", 3, \"selectionChange\"], [\"formControlName\", \"horizon\"], [\"mat-stroked-button\", \"\", \"color\", \"primary\", \"type\", \"submit\"], [\"class\", \"scenario-result\", 4, \"ngIf\"], [1, \"scenario-result\"], [1, \"scenario-column\"], [1, \"delta\", 3, \"ngClass\"], [1, \"slider-row\"], [\"min\", \"0.05\", \"max\", \"0.95\", \"step\", \"0.01\", \"thumbLabel\", \"\", 3, \"input\", \"displayWith\", \"value\"], [\"class\", \"threshold-summary\", 4, \"ngIf\"], [1, \"threshold-summary\"], [1, \"metrics-grid\"], [\"appearance\", \"fill\", 1, \"full-width\"], [\"matInput\", \"\", \"rows\", \"3\", \"placeholder\", \"e.g., Which factors drive these results?\", 3, \"ngModelChange\", \"ngModel\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [\"class\", \"ai-answer\", 4, \"ngIf\"], [1, \"ai-answer\"]],\n        template: function PredictionsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\")(2, \"div\", 4);\n            i0.ɵɵtext(3, \"On-demand Predictions\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 5);\n            i0.ɵɵtext(5, \"Test scenarios for investors and loans.\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(6, \"div\", 6)(7, \"mat-card\", 7)(8, \"mat-card-title\");\n            i0.ɵɵtext(9, \"Investor Churn Prediction\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(10, \"form\", 8);\n            i0.ɵɵlistener(\"ngSubmit\", function PredictionsComponent_Template_form_ngSubmit_10_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.submitInvestor());\n            });\n            i0.ɵɵelementStart(11, \"div\", 9)(12, \"mat-form-field\", 10)(13, \"mat-label\");\n            i0.ɵɵtext(14, \"Age\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(15, \"input\", 11);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"mat-form-field\", 10)(17, \"mat-label\");\n            i0.ɵɵtext(18, \"AUM (USD)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(19, \"input\", 12);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(20, \"div\", 9)(21, \"mat-form-field\", 10)(22, \"mat-label\");\n            i0.ɵɵtext(23, \"Risk tolerance\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"mat-select\", 13);\n            i0.ɵɵtemplate(25, PredictionsComponent_mat_option_25_Template, 3, 4, \"mat-option\", 14);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(26, \"mat-form-field\", 10)(27, \"mat-label\");\n            i0.ɵɵtext(28, \"Engagement score (0-100)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(29, \"input\", 15);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(30, \"div\", 9)(31, \"mat-form-field\", 10)(32, \"mat-label\");\n            i0.ɵɵtext(33, \"Email open rate (0-1)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(34, \"input\", 16);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(35, \"mat-form-field\", 10)(36, \"mat-label\");\n            i0.ɵɵtext(37, \"Calls per quarter\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(38, \"input\", 17);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(39, \"div\", 9)(40, \"mat-form-field\", 10)(41, \"mat-label\");\n            i0.ɵɵtext(42, \"Inactivity days\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(43, \"input\", 18);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(44, \"mat-form-field\", 10)(45, \"mat-label\");\n            i0.ɵɵtext(46, \"Distribution yield (0-1)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(47, \"input\", 19);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(48, \"div\", 9)(49, \"mat-form-field\", 10)(50, \"mat-label\");\n            i0.ɵɵtext(51, \"Meetings last quarter\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(52, \"input\", 20);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(53, \"mat-form-field\", 10)(54, \"mat-label\");\n            i0.ɵɵtext(55, \"Redemption intent\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(56, \"mat-select\", 21)(57, \"mat-option\", 22);\n            i0.ɵɵtext(58, \"No\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(59, \"mat-option\", 22);\n            i0.ɵɵtext(60, \"Yes\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(61, \"button\", 23);\n            i0.ɵɵtext(62);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(63, PredictionsComponent_mat_card_63_Template, 21, 9, \"mat-card\", 24);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(64, \"mat-card\", 7)(65, \"mat-card-title\");\n            i0.ɵɵtext(66, \"Loan Default Prediction\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(67, \"form\", 8);\n            i0.ɵɵlistener(\"ngSubmit\", function PredictionsComponent_Template_form_ngSubmit_67_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.submitLoan());\n            });\n            i0.ɵɵelementStart(68, \"div\", 9)(69, \"mat-form-field\", 10)(70, \"mat-label\");\n            i0.ɵɵtext(71, \"Amount (USD)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(72, \"input\", 25);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(73, \"mat-form-field\", 10)(74, \"mat-label\");\n            i0.ɵɵtext(75, \"LTV ratio (0-1)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(76, \"input\", 26);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(77, \"div\", 9)(78, \"mat-form-field\", 10)(79, \"mat-label\");\n            i0.ɵɵtext(80, \"Term (months)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(81, \"input\", 27);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(82, \"mat-form-field\", 10)(83, \"mat-label\");\n            i0.ɵɵtext(84, \"Sector\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(85, \"mat-select\", 28);\n            i0.ɵɵtemplate(86, PredictionsComponent_mat_option_86_Template, 3, 4, \"mat-option\", 14);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(87, \"mat-form-field\", 10)(88, \"mat-label\");\n            i0.ɵɵtext(89, \"Arrears flag\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(90, \"mat-select\", 29)(91, \"mat-option\", 22);\n            i0.ɵɵtext(92, \"No\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(93, \"mat-option\", 22);\n            i0.ɵɵtext(94, \"Yes\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(95, \"div\", 9)(96, \"mat-form-field\", 10)(97, \"mat-label\");\n            i0.ɵɵtext(98, \"DSCR\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(99, \"input\", 30);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(100, \"mat-form-field\", 10)(101, \"mat-label\");\n            i0.ɵɵtext(102, \"Collateral score (0-1)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(103, \"input\", 31);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(104, \"mat-form-field\", 10)(105, \"mat-label\");\n            i0.ɵɵtext(106, \"Covenants breached\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(107, \"mat-select\", 32)(108, \"mat-option\", 22);\n            i0.ɵɵtext(109, \"No\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(110, \"mat-option\", 22);\n            i0.ɵɵtext(111, \"Yes\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(112, \"button\", 23);\n            i0.ɵɵtext(113);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(114, PredictionsComponent_mat_card_114_Template, 21, 9, \"mat-card\", 33);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(115, \"div\", 34)(116, \"mat-card\", 35)(117, \"mat-card-title\");\n            i0.ɵɵtext(118, \"Investor what-if simulator\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(119, PredictionsComponent_div_119_Template, 29, 4, \"div\", 36)(120, PredictionsComponent_ng_template_120_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(122, \"mat-card\", 35)(123, \"mat-card-title\");\n            i0.ɵɵtext(124, \"Loan what-if simulator\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(125, PredictionsComponent_div_125_Template, 29, 4, \"div\", 36)(126, PredictionsComponent_ng_template_126_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(128, \"mat-card\", 37)(129, \"div\", 38)(130, \"mat-card-title\");\n            i0.ɵɵtext(131, \"Threshold tuning\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(132, \"div\", 39)(133, \"mat-form-field\", 10)(134, \"mat-label\");\n            i0.ɵɵtext(135, \"Problem\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(136, \"mat-select\", 40);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function PredictionsComponent_Template_mat_select_ngModelChange_136_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              i0.ɵɵtwoWayBindingSet(ctx.thresholdMeta.problem, $event) || (ctx.thresholdMeta.problem = $event);\n              return i0.ɵɵresetView($event);\n            });\n            i0.ɵɵlistener(\"selectionChange\", function PredictionsComponent_Template_mat_select_selectionChange_136_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onThresholdMetaChange());\n            });\n            i0.ɵɵtemplate(137, PredictionsComponent_mat_option_137_Template, 3, 4, \"mat-option\", 14);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(138, \"mat-form-field\", 10)(139, \"mat-label\");\n            i0.ɵɵtext(140, \"Horizon\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(141, \"mat-select\", 40);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function PredictionsComponent_Template_mat_select_ngModelChange_141_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              i0.ɵɵtwoWayBindingSet(ctx.thresholdMeta.horizon, $event) || (ctx.thresholdMeta.horizon = $event);\n              return i0.ɵɵresetView($event);\n            });\n            i0.ɵɵlistener(\"selectionChange\", function PredictionsComponent_Template_mat_select_selectionChange_141_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onThresholdMetaChange());\n            });\n            i0.ɵɵtemplate(142, PredictionsComponent_mat_option_142_Template, 2, 2, \"mat-option\", 14);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(143, \"mat-form-field\", 10)(144, \"mat-label\");\n            i0.ɵɵtext(145, \"Model\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(146, \"mat-select\", 40);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function PredictionsComponent_Template_mat_select_ngModelChange_146_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              i0.ɵɵtwoWayBindingSet(ctx.thresholdMeta.family, $event) || (ctx.thresholdMeta.family = $event);\n              return i0.ɵɵresetView($event);\n            });\n            i0.ɵɵlistener(\"selectionChange\", function PredictionsComponent_Template_mat_select_selectionChange_146_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onThresholdMetaChange());\n            });\n            i0.ɵɵtemplate(147, PredictionsComponent_mat_option_147_Template, 3, 4, \"mat-option\", 14);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(148, PredictionsComponent_div_148_Template, 3, 3, \"div\", 41)(149, PredictionsComponent_ng_template_149_Template, 2, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(151, PredictionsComponent_div_151_Template, 18, 47, \"div\", 42);\n            i0.ɵɵelementStart(152, \"mat-card\", 43)(153, \"div\", 44)(154, \"mat-card-title\");\n            i0.ɵɵtext(155, \"Explain with AI\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(156, \"button\", 45);\n            i0.ɵɵlistener(\"click\", function PredictionsComponent_Template_button_click_156_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.aiOpen = !ctx.aiOpen);\n            });\n            i0.ɵɵtext(157);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(158, PredictionsComponent_div_158_Template, 8, 4, \"div\", 46);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            const noInvestorSamples_r24 = i0.ɵɵreference(121);\n            const noLoanSamples_r25 = i0.ɵɵreference(127);\n            const noThresholds_r26 = i0.ɵɵreference(150);\n            i0.ɵɵadvance(10);\n            i0.ɵɵproperty(\"formGroup\", ctx.investorForm);\n            i0.ɵɵadvance(15);\n            i0.ɵɵproperty(\"ngForOf\", ctx.riskOptions);\n            i0.ɵɵadvance(32);\n            i0.ɵɵproperty(\"value\", false);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"value\", true);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loadingInvestor);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.loadingInvestor ? \"Predicting...\" : \"Predict churn\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.investorResult);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"formGroup\", ctx.loanForm);\n            i0.ɵɵadvance(19);\n            i0.ɵɵproperty(\"ngForOf\", ctx.sectorOptions);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"value\", false);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"value\", true);\n            i0.ɵɵadvance(15);\n            i0.ɵɵproperty(\"value\", false);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"value\", true);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loadingLoan);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.loadingLoan ? \"Predicting...\" : \"Predict default\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.loanResult);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.sampleInvestors.length)(\"ngIfElse\", noInvestorSamples_r24);\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngIf\", ctx.sampleLoans.length)(\"ngIfElse\", noLoanSamples_r25);\n            i0.ɵɵadvance(11);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.thresholdMeta.problem);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.thresholdProblems);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.thresholdMeta.horizon);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.thresholdHorizons);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.thresholdMeta.family);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.thresholdFamilies);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.thresholdGrid.length)(\"ngIfElse\", noThresholds_r26);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.metrics);\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate1(\" \", ctx.aiOpen ? \"Minimize\" : \"Open\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.aiOpen);\n          }\n        },\n        dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.NgModel, i1.FormGroupDirective, i1.FormControlName, i5.MatButton, i6.MatCard, i6.MatCardSubtitle, i6.MatCardTitle, i7.MatFormField, i7.MatLabel, i8.MatInput, i9.MatSelect, i10.MatOption, i11.BaseChartDirective, i12.MatSlider, i4.SlicePipe, i4.DecimalPipe, i4.TitleCasePipe],\n        styles: [\".header[_ngcontent-%COMP%]{margin-bottom:.5rem}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}.form-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.two-col[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:.5rem}.result-card[_ngcontent-%COMP%]{margin-top:.75rem;background:var(--surface-2);border:1px solid var(--border)}.result-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem;align-items:center;margin:.5rem 0}.label[_ngcontent-%COMP%]{font-size:.85rem;color:#94a3b8}.value[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700}.chip[_ngcontent-%COMP%]{padding:.2rem .6rem;border-radius:999px;text-transform:capitalize}.chip.high[_ngcontent-%COMP%]{background:#ef444433;color:#ef4444}.chip.medium[_ngcontent-%COMP%]{background:#f59e0b26;color:#f59e0b}.chip.low[_ngcontent-%COMP%]{background:#22c55e26;color:#22c55e}.ai-card[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.ai-card[_ngcontent-%COMP%]   .ai-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:.5rem}.ai-answer[_ngcontent-%COMP%]{margin-top:.75rem;padding:.75rem;border-radius:8px;background:var(--surface-2);border:1px solid var(--border);white-space:pre-wrap}.horizon-table[_ngcontent-%COMP%]{width:100%;margin-top:.5rem;border-collapse:collapse}.horizon-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .horizon-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid var(--border);padding:.35rem;text-align:left}.horizon-table.compact[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .horizon-table.compact[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.25rem .35rem;font-size:.9rem}.model-compare[_ngcontent-%COMP%]{margin-top:.5rem}.scenario-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1rem;margin-top:1rem}.scenario-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.scenario-result[_ngcontent-%COMP%]{margin-top:.75rem;padding:.75rem;border:1px solid var(--border);border-radius:8px;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.75rem;background:var(--surface-2)}.scenario-column[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.3rem}.delta[_ngcontent-%COMP%]{margin-top:.25rem;font-weight:600;color:#16a34a}.delta.worse[_ngcontent-%COMP%]{color:#ef4444}.horizon-table[_ngcontent-%COMP%] + canvas[_ngcontent-%COMP%]{margin-top:.5rem}\"]\n      });\n    }\n  }\n  return PredictionsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}